/*!
 * Web UI Loader - https://webui.stoicdreams.com
 * This script is used to dynamically load Web UI web components (webui-*) from cdn.myfi.ws and app components (app-*) from the local /wc (webui.appSrc) folder as they are encountered in the dom.
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2024-2025 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
"use strict";const webui=(()=>{{const markdownSrc="3180"===location.port?"/js/mdparse.min.js":"https://cdn.myfi.ws/js/mdparse.min.js";import(markdownSrc).then((module=>{webui.markdown=new module.MarkdownParser,webui.loaded=!0}))}const domain=location.hostname,AsyncFunction=(async()=>{}).constructor;window.AsyncFunction=AsyncFunction;const map={subs:{}};window.subs=map.subs;const resizeSubscribers={},roles={};function updatePageTitle(){let pt=[];pt.push(webui.getData("page-title")),pt.push(webui.getData("page-subtitle")),pt.push(location.hash),pt=pt.filter((a=>!!a));let title=pt.join(": ")||webui.getData("app-company-singular");title&&(document.title=webui.replaceAppData(title))}let lastActive=Date.now();{const minTimeout=3e5;function checkForRoleRefresh(){if(0!==webui.userRoles){let autoSignout=60*(webui.getData("session-autosignout")||30)*1e3;autoSignout<minTimeout&&(autoSignout=minTimeout);let expiresAt=lastActive+autoSignout;Date.now()<expiresAt?(setTimeout((()=>checkForRoleRefresh()),autoSignout),webui.loadRoles()):setTimeout((()=>checkForRoleRefresh()),minTimeout)}else setTimeout((()=>checkForRoleRefresh()),minTimeout)}setTimeout((()=>checkForRoleRefresh()),minTimeout)}const appDataOnce=[],appDataLimit=["app-name","app-company-singular","app-company-possessive","app-domain","app-api","app-not-found-html","app-data-endpoint","app-content-endpoint"],notifyForAppDataChanges=[],notifyForSessionDataChanges=[];function notifyAppDataChanged(changeDetails){notifyForAppDataChanges.forEach((handler=>{handler&&handler(changeDetails,watchedAppData)}))}function notifySessionDataChanged(changeDetails){notifyForSessionDataChanges.forEach((handler=>{handler&&handler(changeDetails,watchedSessionData)})),storage.setItem("session-data",JSON.stringify(watchedSessionData))}function getHandler(notifyHandler){return{set(target,property,value,receiver){const oldValue=target[property],changeType=property in target?"update":"add",success=Reflect.set(target,property,value,receiver);return success&&oldValue!==value&&notifyHandler({type:changeType,property:property,oldValue:oldValue,newValue:value,timestamp:new Date}),success},deleteProperty(target,property){if(property in target){const oldValue=target[property],success=Reflect.deleteProperty(target,property);return success&&notifyHandler({type:"delete",property:property,oldValue:oldValue,timestamp:new Date}),success}return!0}}}const watchedAppData=(()=>{const appData={"app-name":"App","app-company-singular":"Company","app-company-possessive":"Company's","app-content-endpoint":"/d","app-domain":domain.toLowerCase(),"page-title":"","page-subtitle":"","page-path":location.pathname};return new Proxy(appData,getHandler(notifyAppDataChanged))})();window.appData=watchedAppData;let isProcessing=!1;const watchedSessionData=new Proxy({"session-user-role":0,"session-username":"Guest","session-full-name":"Guest","session-first-name":"Guest","session-last-name":"","session-autosignout":30},getHandler(notifySessionDataChanged));window.sessionData=watchedSessionData;const appSettings={appType:"website",isDesktopApp:!1,rootPage:"root",contentExtension:".md",pageContentEndpoint:"/d",encryptPageContent:!1,encryptPageData:"base64"};const memStorageCache={},cachedFetches={};let acceptedStorage="1";function getCache(){return new Promise(((resolve,reject)=>{localStorage.getItem("storage_accepted")?resolve(localStorage):resolve(sessionStorage)}))}localStorage.key("storage_accepted")&&"2"===localStorage.getItem("storage_accepted")?(acceptedStorage="2",Object.keys(localStorage).forEach((key=>{memStorageCache[key]=localStorage.getItem(key)})),sessionStorage.clear()):(acceptedStorage="1",Object.keys(sessionStorage).forEach((key=>{memStorageCache[key]=sessionStorage.getItem(key)})),localStorage.clear());const storage=new class{STORAGE_ACCEPTED_KEY="storage_accepted";ACCEPT_SESSION_STORAGE="1";ACCEPT_LOCAL_STORAGE="2";key(key){return Object.keys(memStorageCache).filter((m=>m==key)).length>0?key:null}clear(){Object.keys(memStorageCache).forEach((key=>{this.removeItem(key)})),getCache().then((cache=>{cache.clear()}))}removeItem(key){delete memStorageCache[key],getCache().then((cache=>{cache.removeItem(key)})).catch((_=>{}))}setItem(key,value){memStorageCache[key]=value,getCache().then((cache=>{cache.setItem(key,value)})).catch((_=>{}))}getItem(key){return memStorageCache[key]??""}acceptLocalStorage(){acceptedStorage="2",this.setItem("storage_accepted",acceptedStorage),sessionStorage.clear(),Object.keys(memStorageCache).forEach((key=>{localStorage.setItem(key,memStorageCache[key])}))}acceptSessionStorage(){acceptedStorage="1",this.setItem("storage_accepted",acceptedStorage),localStorage.clear(),Object.keys(memStorageCache).forEach((key=>{sessionStorage.setItem(key,memStorageCache[key])}))}};const webui=new class{appSrc="/wc";appMin=".min";appConfig={};markdown={parse:(...args)=>(console.error("Unhandled webui.markdown parse",args),"")};constructor(){this._appSettings=appSettings,this.storage=storage;let cachedSessionData=this.storage.getItem("session-data")||{};"string"==typeof cachedSessionData&&(cachedSessionData=JSON.parse(cachedSessionData)),Object.keys(cachedSessionData).forEach((key=>{watchedSessionData[key]=cachedSessionData[key]}))}alert(message,variant){webui.log.warn("Alerts are not setup for this website",message,variant)}applyAppDataToContent(content,preTrim,noParagraph){let data=void 0!==typeof preTrim&&"boolean"!=typeof preTrim?preTrim:void 0,pt="boolean"==typeof preTrim?preTrim:void 0;return this.parseWebuiMarkdown(this.replaceAppData(content,data),pt,noParagraph)}applyDynamicStyles(){}clone(data){if(null==data)return data;if("object"!=typeof data)return data;try{return structuredClone(data)}catch{return data={...data},structuredClone(data)}}escapeCode(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}escapeQuote(text){return text.replace(/"/g,"&quot;")}escapeHtml(text){return text.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}create(name,attr){let el=document.createElement(name);return this.attachAttributes(el,attr)}createFromHTML(html,attr){let container=this.create("div");container.innerHTML=html;let el=container.childNodes[0];return el?this.attachAttributes(el,attr):el}attachAttributes(el,attr){return attr&&Object.keys(attr).forEach((key=>{switch(key){case"innerHTML":case"html":el.innerHTML=attr[key];break;case"innerText":case"text":el.innerText=attr[key];break;default:"function"==typeof attr[key]?el.addEventListener(key,attr[key]):el.setAttribute(key,attr[key])}})),el}closest(target,selector){if(!target)return null;if(target.composedPath instanceof Function){const path=target.composedPath();for(const el of path)if(el instanceof Element&&el.matches(selector))return el}else{let el=target;for(;el;){if(el.matches instanceof Function&&el.matches(selector))return el;el=el.parentNode||el.host}}return null}async copyToClipboard(value){await navigator.clipboard.writeText(value),webui.alert("Copied code to clipboard","success")}define(name,options){if("string"!=typeof name)return void console.error("name in webui.define(name) must be a string");if("webui-"!==name.substring(0,6)&&"app-"!==name.substring(0,4))return void console.error("name in webui.define(name) must start with the prefix `app-`.");(options=options||{}).attr=options.attr||[],"string"==typeof options.attr&&(options.attr=options.attr.split(/[, ]+/)),options.flags=options.flags||[],"string"==typeof options.flags&&(options.flags=options.flags.split(/[, ]+/)),["class"].forEach((attr=>{-1===options.attr.indexOf(attr)&&options.attr.push(attr)}));let shadowTemplate=0;options.shadowTemplate&&(shadowTemplate=webui.create("template"),shadowTemplate.setAttribute("shadowrootmode",!0),options.linkCss?shadowTemplate.innerHTML=`<link rel="stylesheet" href="https://cdn.myfi.ws/css/webui.min.css">${options.shadowTemplate}`:shadowTemplate.innerHTML=options.shadowTemplate,delete options.shadowTemplate),options.watchVisibility&&-1===options.attr.indexOf("visible")&&options.attr.push("visible");let isInput=options.isInput||-1!==name.indexOf("input");class CustomElement extends HTMLElement{static formAssociated=isInput;disconnectHandlers=[];constructor(){super();const t=this;if(isInput&&(t.internals_=t.attachInternals(),t.addEventListener("keyup",(ev=>{if("Enter"===ev.key&&ev.ctrlKey){let form=t.internals_.form;ev.preventDefault(),ev.stopPropagation(),form?.requestSubmit()}}))),options.props&&Object.keys(options.props).forEach((key=>{Object.defineProperty(t,key,options.props[key])})),isInput&&(Object.defineProperty(t,"name",{get:()=>t.getAttribute("name"),set(v){t.setAttribute("name",v)}}),t.formResetCallback||(t.formResetCallback=()=>{t.value=""}),t.formStateRestoreCallback||(t.formStateRestoreCallback=state=>{t.value=state}),t.addEventListener("input",(_=>{t.internals_.setFormValue(t.value)})),t.addEventListener("change",(_=>{t.internals_.setFormValue(t.value)}))),t._id=`d${webui.uuid()}`.split("-").join("").toLowerCase(),t.options=options,shadowTemplate&&(t.template=shadowTemplate.content.cloneNode(!0)),Object.keys(options).forEach((key=>{t[key]=options[key]})),options.constructor&&options.constructor(t),options.watchVisibility){let observer=new IntersectionObserver(onIntersection,{root:null,scrollMargin:"0px",threshold:0,delay:100});function onIntersection(entries,_opts){entries.forEach((entry=>{entry.isIntersecting?entry.target.setAttribute("visible",1):entry.target.removeAttribute("visible")}))}observer.observe(t),this.disconnectHandlers.push((()=>{observer.unobserve(t)}))}if(shadowTemplate){const shadow=t.attachShadow({mode:"open"});function removeBugAttributes(el){["value","preload","data-options","data-trigger","data-subscribe"].forEach((key=>{el.removeAttribute(key)}))}["input","select"].forEach((selector=>{webui.querySelectorAll(selector,t.template).forEach((el=>{["event","click","blur"].forEach((evname=>{el.addEventListener(evname,(ev=>{setTimeout((()=>{removeBugAttributes(el)}),0)}))}))}))})),shadow.appendChild(t.template)}}static get observedAttributes(){return options.attr.concat(options.flags)}addDataset(key,value){const t=this;if(t.hasDataset(key,value))return void webui.log.info("Dataset already has that value",key,value);let ds=t.getAttribute(`data-${key}`);ds=ds?ds.split("|"):[],ds.push(value),t.setAttribute(`data-${key}`,ds.join("|"))}hasDataset(key,value){let ds=this.getAttribute(`data-${key}`);if(ds=ds?ds.split("|"):[],void 0===value)return 0!==ds.length;let found=!1;return ds.forEach((item=>{item.split(":")[0]===key&&(found=!0)})),found}attributeChangedCallback(property,oldValue,newValue){const t=this;if(oldValue===newValue)return;let propDefined=property;property=webui.toCamel(property),-1!==["class"].indexOf(property)&&(property=`_${property}`),"_class"===property&&t.shadowRoot&&t.shadowRoot.childNodes&&t.shadowRoot.childNodes.forEach((node=>{"SLOT"===node.nodeName&&(node.className=newValue)})),-1!==options.flags.indexOf(propDefined)||-1!==options.flags.indexOf(property)?newValue=webui.setFlag(this,property,newValue):webui.setProperty(this,property,newValue),options.attrChanged&&options.attrChanged(this,property,newValue)}connectedCallback(){const t=this;"function"==typeof options.onResize&&(resizeSubscribers[t._id]=options.onResize.bind(t)),options.content&&t.classList.add("content"),t._connectedInit?"function"==typeof options.reconnected&&setTimeout((()=>{options.reconnected(t)}),1):(t._connectedInit=!0,t._isConnected=!0,checkAddedNode(t),options.preload&&t.setAttribute("preload",options.preload),"function"==typeof options.connected&&setTimeout((()=>{options.connected(t)}),1),t.shadowRoot&&t.shadowRoot&&t.shadowRoot.childNodes&&(t.setAttribute("has-shadow",!0),t.shadowRoot.childNodes.forEach((node=>{"SLOT"===node.nodeName&&(node.classList=t.classList)}))),isInput&&t.internals_.setFormValue(t.value))}disconnectedCallback(){const t=this;t._isConnected=!1,resizeSubscribers[t._id]&&delete resizeSubscribers[t._id],"function"==typeof options.disconnected&&options.disconnected(t),t.disconnectHandlers.forEach((h=>{h()}))}getSlot(name){let node=null;return this.childNodes.forEach((n=>{n.slot===name&&(node=n)})),node}isFlagged(name){return void 0!==this[name]&&!1!==this[name]}setTheme(value){this.style.setProperty("--theme-color",`var(--color-${value})`),this.style.setProperty("--theme-color-offset",`var(--color-${value}-offset)`)}setHeight(value){let num=webui.pxIfNumber(value);this.style.height=num,this.style.minHeight=num}snapshot(){const t=this;let snapshot={};return t.options?.attr?.length&&t.options.attr.forEach((attr=>{let key=webui.toCamel(attr);snapshot[key]=t[key]})),t.props&&Object.keys(t.props).forEach((key=>{snapshot[key]=t[key]})),void 0!==t.value&&(snapshot.value=t.value),snapshot.classList=Array.from(t.classList).sort(),t._snapshot=JSON.stringify(snapshot),t._snapshot}get hasChanges(){let a=this._snapshot,b=this.snapshot();return void 0===a||a!==b}}customElements.define(name,CustomElement,{})}displaySeconds(value,onZero="0 seconds"){let seconds=parseFloat(value)||0;if(0===seconds)return onZero;if(seconds<60)return`${value} seconds`;let min=Math.floor(seconds/60);if(seconds%=60,min<60)return`${min} min, ${seconds} sec`;let hr=Math.floor(min/60);if(min%=60,hr<24)return`${hr} hr${hr>1?"s":""}, ${min} min, ${seconds} sec`;let days=Math.floor(hr/24);hr%=24;let result=[];return result.push(`${days} day${days>1?"s":""}`),min+=60*hr,seconds+=60*min,seconds>0&&result.push(webui.displaySeconds(seconds)),result.join(" ")}displayMinutes(value,onZero="0 minutes"){let min=parseFloat(value)||0;if(0===min)return onZero;if(min<60)return`${min} minutes`;let hr=Math.floor(min/60);if(min%=60,hr<24)return`${hr} hr${hr>1?"s":""}, ${min} min`;let days=Math.floor(hr/24);hr%=24;let result=[];return result.push(`${days} day${days>1?"s":""}`),min+=60*hr,min>0&&result.push(webui.displayMinutes(min)),result.join(" ")}displayLeadingZero(number,count=1){let pad=1+count-`${number}`.length;return pad<=0?`${number}`:`${"0".repeat(pad)}${number}`}escapeForHTML(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\//g,"&#x2F;").replace(/`/g,"&#96;")}async fetchApi(url,data,method="POST"){const t=this;if(!url.startsWith("http")){let count=0;for(;!t.appConfig.appApi&&count<500;)await t.wait(10);const api=t.appConfig.appApi||"";url="/"===url[0]?`${api}${url}`:`${api}/${url}`}let headers={};data&&data.headers&&(headers=data.headers,delete data.headers);let body=data;return headers["Content-Type"]="text/plain",headers["x-cookie-age"]||(headers["x-cookie-age"]=webui.getData("session-autosignout")||30),-1!==["get"].indexOf(method.toLowerCase())?body=void 0:data instanceof FormData?headers["Content-Type"]="multipart/form-data":"string"!=typeof data&&(headers["Content-Type"]="application/json",body=JSON.stringify(data)),await fetch(url,{method:method.toUpperCase(),credentials:"include",mode:"cors",cache:"no-cache",body:body,headers:headers})}fetchWithCache(url,isJson){return new Promise(((resolve,reject)=>{cachedFetches[url]?resolve(cachedFetches[url]):fetch(url).then((async res=>{isJson?await res.json().then((json=>{cachedFetches[url]=json,resolve(json)})):await res.text().then((text=>{cachedFetches[url]=text,resolve(text)}))})).catch((ex=>{reject(ex)}))}))}fromBase64(encoded){for(encoded=encoded.replace(/-/g,"+").replace(/_/g,"/");encoded.length%4!=0;)encoded=`${encoded}=`;return atob(encoded)}formatBytes(bytes,decimals=2){if(!+bytes)return"0 Bytes";const dm=decimals<0?0:decimals,i=Math.floor(Math.log(bytes)/Math.log(1024));return`${parseFloat((bytes/Math.pow(1024,i)).toFixed(dm))} ${["Bytes","KB","MB","GB"][i]}`}getBase64Size(base64String){if(!base64String)return 0;let clean=base64String.includes(",")?base64String.split(",")[1]:base64String,padding=(clean.match(/=*$/)||[""])[0].length;return.75*clean.length-padding}getData(...args){if(0===args.length)return;if(args.length>1){let result=[];return args.forEach((key=>{result.push(webui.getData(key))})),result}if("string"!=typeof args[0])return void console.error("Invalid key for webui.getData",args[0],args);let key=args[0].split(":")[0],dataContainer=webui.toSnake(key,"-").startsWith("session-")?watchedSessionData:watchedAppData,data=webui.getNestedData(key,dataContainer);return void 0===data?(data=webui.getNestedData(`session-${key}`,watchedSessionData),void 0!==data?webui.clone(data):(data=webui.getNestedData(`app-${key}`,watchedAppData),void 0!==data?webui.clone(data):void 0)):"object"!=typeof data?data:webui.clone(data)}getNestedData(key,data){let segments=key.split(".");if(!data)return;if(1===segments.length){let skey=webui.toSnake(key,"-");return webui.getDefined(data[skey],data[key],void 0)}key=segments.shift();let skey=webui.toSnake(key,"-");for(data=webui.getDefined(data[skey],data[key],void 0);segments.length>0;){if(!data)return;key=segments.shift(),skey=webui.toSnake(key,"-"),data=webui.getDefined(data[skey],data[key],void 0)}return data}getDefined(...args){for(let index=0;index<args.length;++index)if(void 0!==args[index]&&null!==args[index])return args[index]}getHtmlFromTemplate(template,data){if(!template||"function"!=typeof template.assignedElements)return"";let html=[];return template.assignedElements().forEach((t=>{let v=t.innerHTML;v&&html.push(v)})),this.applyAppDataToContent(html.join("\n"),data)}getQueryData(key){let data=location.search;if(!data||"?"!==data[0])return null;let dict={};return data.substring(1).split("&").forEach((kv=>{kv=kv.split("="),dict[kv[0]]=kv[1]})),key?dict[key]:dict}getResponseHeader(resp,...keys){let message;return keys.forEach((key=>{message||(message=resp.headers.get(key))})),message}getSearchData(key){return webui.getQueryData(key)}hashCode(text){if(void 0===typeof text)return 0;if("string"!=typeof text)return-1;let hash=2166136261;text=text||"";for(let i=0;i<text.length;i++)hash^=text.charCodeAt(i),hash=16777619*hash>>>0;return 0|hash}async hashSHA256(text){if(void 0===window.crypto||void 0===window.crypto.subtle)throw new Error("Web Cryptography API is not available in this environment.");const data=(new TextEncoder).encode(text),hashBuffer=await crypto.subtle.digest("SHA-256",data);return Array.from(new Uint8Array(hashBuffer)).map((b=>b.toString(16).padStart(2,"0"))).join("")}hasSetter(el,field){if(!el||"string"!=typeof field)return!1;let proto=el;for(;proto;){const descriptor=Object.getOwnPropertyDescriptor(proto,field);if(descriptor&&"function"==typeof descriptor.set)return!0;proto=Object.getPrototypeOf(proto)}return!1}isEqual(a,b){return a===b||typeof a==typeof b&&(a!=a&&b!=b||JSON.stringify(a)===JSON.stringify(b))}get isLocalhost(){return"localhost"===domain||"NaN"!==parseInt(domain).toString()}isTextOverflowing(el){return el.scrollWidth>el.clientWidth+1}get isSignedIn(){return!(0===(this.getDefined(this.getData("session-user-role"),0)&&1))}limitChars(text,limit){if(!text||!text.length||text.length<=limit)return text;let words=text.split(" "),count=0,result=[];function addWord(word){count+=word.length,result.push(word)}for(result.push(words.unshift()),addWord(words.unshift());words.length>0;){let word=words.unshift();if(count+word.length>limit)break;addWord(words.unshift())}return result.join(" ")}log=(()=>{let log=(...args)=>console.log(...args);return log.assert=(...args)=>console.assert(...args),log.info=(...args)=>console.info(...args),log.dir=(...args)=>console.dir(...args),log.trace=(...args)=>console.trace(...args),log.error=(...args)=>console.error(...args),log.warn=(...args)=>console.warn(...args),log.time=key=>console.time(key),log.timeEnd=key=>console.timeEnd(key),log})();unitIfNumber(input,unit){let num=parseFloat(input);return num===input||`${num}`===input?`${num}${unit}`:input}pxIfNumber(input){return this.unitIfNumber(input,"px")}msIfNumber(input){return this.unitIfNumber(input,"ms")}navigateTo(href){changePage(href)}updateHash(hash){""!==(hash=(hash="string"!=typeof hash?"":hash).trim())&&"#"!==hash[0]&&(hash=`#${hash}`),changePage(`${location.pathname}${hash}${location.search}`),updatePageTitle()}removeWrappingPTags(html,tagPattern){for(;html.match(`<p><(${tagPattern})[> ]{1}`);){let orig=html;if((html=html.replace(new RegExp(`<p>(<(${tagPattern}).+</\\2>)</p>`,"g"),"$1"))===orig)break}return html}async closeSharedDrawer(){let el=document.querySelector("webui-drawer.shared");el&&el.classList.contains("open")&&(el.classList.remove("open"),await webui.wait(400))}async openSharedDrawer(header,content){if(void 0===content&&(content=header,header=void 0),"function"==typeof header&&(header=header.constructor==AsyncFunction?await header():header()),"string"==typeof header){const container=webui.create("header");container.style.padding="var(--padding)",container.setAttribute("slot","header"),container.innerHTML=header,header=container}else{let hc=header;(header=webui.create("header")).style.padding="var(--padding)",header.setAttribute("slot","header"),hc&&header.appendChild(hc)}if("function"==typeof content&&(content=content.constructor==AsyncFunction?await content():content()),"string"==typeof content){const container=webui.create("section");container.style.padding="var(--padding)",container.style.display="flex",container.style.flexDirection="column",container.style.flexGrow="1",container.style.overflow="auto",container.style.gap="var(--padding)",container.innerHTML=content,content=container}let el=document.querySelector("webui-drawer.shared");if(el)return el.classList.contains("open")&&(el.classList.remove("open"),await webui.wait(400)),el.innerHTML="",el.appendChild(header),el.appendChild(content),await webui.wait(100),el.classList.add("open"),content;webui.dialog({title:header,content:content,confirm:"Close"})}parseWebuiMarkdown(md,preTrim,noParagraph){return this.parseMarkdown(md,preTrim,noParagraph)}parseMarkdown(md,preTrim,noParagraph){const t=this;return"string"!=typeof md?md:(preTrim&&(md=t.trimLinePreWhitespce(md)),t.markdown.parse(md,noParagraph)||"")}removeFromParentPTag(el){if(el.parentNode&&"P"===el.parentNode.nodeName){let p=el.parentNode;p.parentNode&&(p.parentNode.insertBefore(el,p),""===p.innerHTML.trim()&&p.remove())}return el}removeChildren(el,condition){let tr=[];return el.childNodes.forEach((ch=>{"function"==typeof condition?condition(ch)&&tr.push(ch):tr.push(ch)})),tr.forEach((ch=>{ch.remove()})),tr}removeClass(el,prefix){let r=[];el.classList.forEach((c=>{c.startsWith(prefix)&&r.push(c)})),r.forEach((c=>el.classList.remove(c)))}removeElements(parent,selector,action){let tr=[];parent.querySelectorAll(selector).forEach((n=>{tr.push(n),"function"==typeof action&&action(n)})),tr.forEach((n=>{n.remove()}))}repeat(digit,length){if(!length)return"";let digits=[],index=0;for(;index++<length;)digits.push(digit);return digits.join("")}replaceAppData(text,data){return"string"!=typeof text||(data&&(text=this.replaceData(text,data)),[watchedAppData,watchedSessionData].forEach((dataContainer=>{Object.keys(dataContainer).forEach((key=>{let keys=[];keys.push(`{${this.toSnake(key).toUpperCase()}}`),key.startsWith("session-")?keys.push(`{${this.toSnake(key.substring(8)).toUpperCase()}}`):key.startsWith("app-")&&keys.push(`{${this.toSnake(key.substring(4)).toUpperCase()}}`);let val=webui.getData(key);null==val&&(val=""),keys.forEach((rkey=>{let limit=0;try{for(;-1!==text.indexOf(rkey)&&limit<1e3;)++limit,text=text.replace(rkey,val)}catch(ex){console.error("text",text,ex)}}))}))}))),text}replaceData(text,data){if(-1!==text.indexOf("{TEMPLATE_ROWDATA}")){let rowData=webui.escapeForHTML(JSON.stringify(data));for(;-1!==text.indexOf("{TEMPLATE_ROWDATA}");)text=text.replace("{TEMPLATE_ROWDATA}",rowData)}return Object.keys(data).forEach((key=>{let rkey=`{${`${key.replace(/-/g,"_").toUpperCase()}`}}`,tkey=`{TEMPLATE_${key.replace(/-/g,"_").toUpperCase()}}`,val=data[key];null==val&&(val="");let limit=0;for(;-1!==text.indexOf(rkey)&&limit<1e3;)++limit,text=text.replace(rkey,val);for(limit=0;-1!==text.indexOf(tkey)&&limit<1e3;)++limit,text=text.replace(tkey,val)})),text}resolveFunctionFromString(value,context=window){const t=this,parts=value.split(".");if(0===parts.length)return;"webui"===parts[0]&&(context=t,parts.shift());let func=parts.reduce(((acc,part)=>{if(acc&&"object"==typeof acc&&part in acc)return acc[part]}),context);return"function"==typeof func?func:null}setApp(app){appSettings.app=app}setData(key,value){if(!key)return;let sections=(key=key.split(":")[0]).split("."),baseKey=webui.toSnake(sections[0],"-");if(-1!==appDataLimit.indexOf(baseKey)){if(-1!==appDataOnce.indexOf(baseKey))return void webui.log.warn(`${key} is a reserved key and cannot be set again after initialization`);appDataOnce.push(baseKey)}let dataContainer=key.startsWith("session-")?watchedSessionData:watchedAppData;if(value=webui.clone(value),1===sections.length){if(key=webui.toSnake(key,"-"),JSON.stringify(dataContainer[key])===JSON.stringify(value))return;null==value?delete dataContainer[key]:dataContainer[key]=value}else{let skey=sections.shift();skey=webui.toSnake(skey,"-"),dataContainer[skey]||(dataContainer[skey]={});let segment=dataContainer[skey];for(;sections.length>1;)skey=sections.shift(),skey=webui.toSnake(skey,"-"),segment[skey]||(segment[skey]={}),segment=segment[skey];if(skey=sections.shift(),JSON.stringify(segment[skey])===JSON.stringify(value))return;null==value?delete segment[skey]:segment[skey]=value}Object.keys(map.subs).forEach((skey=>{skey.split(".")[0]===baseKey&&map.subs[skey].forEach((node=>{setDataToEl(node,skey)}))})),-1!==["page-title","page-subtitle"].indexOf(key)&&updatePageTitle()}querySelectorAll(selector,rootNode=document){const results=[];return rootNode&&"function"==typeof rootNode.querySelectorAll?(rootNode.querySelectorAll(selector).forEach((element=>{results.push(element)})),rootNode.querySelectorAll("[has-shadow]").forEach((element=>{if(element.shadowRoot){const nestedResults=webui.querySelectorAll(selector,element.shadowRoot);results.push(...nestedResults)}})),results):[]}setDefaultData(data,defaultData){return data&&defaultData?(defaultData=JSON.parse(JSON.stringify(defaultData)),Object.keys(defaultData).forEach((key=>{-1!==[void 0,null].indexOf(data[key])&&(data[key]=defaultData[key])})),data):data}setFlag(el,property,value){return-1!==[void 0,null,0,!1,"false","null","undefined","0"].indexOf(value)?(el[property]=!1,!1):(el[property]=!0,!0)}setProperty(el,property,value){if("value"!==property&&null==value?delete el[property]:el[property]=value,"elevation"===property)webui.removeClass(el,"elevation-"),value>0?el.classList.add(`elevation-${value}`):value<0&&el.classList.add("elevation-n"+-1*value)}setTheme(el,value){el.style.setProperty("--theme-color",`var(--color-${value})`),el.style.setProperty("--theme-color-offset",`var(--color-${value}-offset)`)}targetMatchesCheck(parent,target,check,onSuccess){for(;;){if(!target)return!1;if(parent===target)return!1;switch(typeof check){case"function":if(check(target))return"function"==typeof onSuccess&&onSuccess(target),!0;break;case"string":if(target.nodeName===check)return"function"==typeof onSuccess&&onSuccess(target),!0;break;default:return!1}target=target.parentNode||target.host}}toSnake(key,delim="_"){return key.trim().replace(/[A-Z]{1}/g,(letter=>`${delim}${letter.toLowerCase()}`)).replace(/[-_ ]+/g,(_=>delim))}toCamel(key){return key.trim().replace(/((-| )[A-Za-z0-9]{1})/g,(a=>a[1].toUpperCase())).replace(/^[A-Z]{1}/,(a=>a.toLowerCase()))}toPascel(key){return key.trim().replace(/((-| )[A-Za-z0-9]{1})/g,(a=>a[1].toUpperCase())).replace(/^[a-z]{1}/,(a=>a.toUpperCase()))}transferChildren(from,to){let nodes=[];from.childNodes.forEach((ch=>{nodes.push(ch)})),nodes.forEach((ch=>{to.appendChild(ch)}))}trimLinePreTabs(html,tabLength=4){let lines=[],tabRepl=webui.repeat(" ",tabLength),startLines=html.replace(/\t/g,tabRepl).split("\n"),tabLen=999,index=0;for(let line of startLines){if(0==index++)continue;let m=line.match(/^([ ]*)/)[0].length;if(0===m)return html;m<tabLen&&(tabLen=m)}if(999===tabLen&&(tabLen=0),0===tabLen)return html;let rgx=new RegExp(`^[ ]{1,${tabLen}}`);for(let line of startLines)lines.push(line.replace(rgx,""));return lines.join("\n")}trimLinePreWhitespce(html){let lines=[];return html.split("\n").forEach((l=>{lines.push(l.trim())})),lines.join("\n")}async try(handler,onError,onFinally){if("function"==typeof handler)try{return handler.constructor==AsyncFunction?await handler():handler()}catch(ex){"function"==typeof onError&&onError(ex)}finally{"function"==typeof onFinally&&onFinally(ex)}else console.error("Invalid handler for webui.try - expecting function",handler,onError)}async trySoloProcess(handler,onError){if("function"==typeof handler){if(!isProcessing){isProcessing=!0;try{return handler.constructor==AsyncFunction?await handler():handler()}catch(ex){"function"==typeof onError&&onError(ex)}finally{isProcessing=!1}}}else console.error("Invalid handler for webui.trySoloProcess - expecting function",handler,onError)}eventSoloProcess(handler,onError){if("function"==typeof handler)return async()=>{if(!isProcessing){isProcessing=!0;try{return handler.constructor==AsyncFunction?await handler():handler()}catch(ex){"function"==typeof onError&&onError(ex)}finally{isProcessing=!1}}};console.error("Invalid handler for webui.eventSoloProcess - expecting function",handler,onError)}async loadRoles(){const t=this;if(t.appConfig&&t.appConfig.rolesApi){let resp=await t.fetchApi(t.appConfig.rolesApi,null,"get");if(200===resp.status){let cookieAge=parseInt(resp.headers.get("X-Cookie-Age")||"")||30;cookieAge>0&&t.setData("session-autosignout",cookieAge);let r=parseInt(await resp.text());r>=-1?t.setData("session-user-role",r):t.setData("session-user-role",0)}}else console.warn("Cannot load roles, missing configuration.")}hasRole(role){return(this.userRoles&role)===role}get roles(){return roles}get userRoles(){return this.getData("session-user-role")}uuid(){try{return crypto.randomUUID()}catch(ex){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(c){let r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)}))}}watchData(data,handler){return new Proxy(data,getHandler(handler))}watchAppDataChanges(handler){notifyForAppDataChanges.push(handler)}watchSessionDataChanges(handler){notifyForSessionDataChanges.push(handler)}unwatchAppDataChanges(handler){let index=notifyForAppDataChanges.indexOf(handler);-1!==index&&notifyForAppDataChanges.splice(index,1)}unwatchSessionDataChanges(handler){let index=notifyForSessionDataChanges.indexOf(handler);-1!==index&&notifyForSessionDataChanges.splice(index,1)}validateUrl(string,protocols=["http:","https:"]){let url;try{url=new URL(string)}catch(_){return!1}return!protocols||!protocols.indexOf||-1!==protocols.indexOf(url.protocol)}wait(milliseconds){return new Promise((async resolve=>{if("function"==typeof milliseconds){let count=0,result=milliseconds(++count);for(;!result&&count<1e3;)await webui.wait(10),result=milliseconds(++count);resolve(count)}else setTimeout(resolve,milliseconds)}))}};function getNodeKey(node){let segments=[];return segments.push(node.nodeName.toLowerCase()),node.classList.length&&segments.push(node.classList[0]),["id","name"].forEach((attr=>{let val=node.attributes[attr];val&&val.value&&segments.join(`${attr}-${val.value}`)})),segments.join("_")}function loadState(node){let key=getNodeKey(node),item=storage.getItem(key);if(!item)return;let state=JSON.parse(item);node.dataset.state.split("|").forEach((attr=>{state[attr]?node.setAttribute(attr,state[attr]):node.removeAttribute(attr)}))}function checkNodes(nodes){0!==nodes.length&&nodes.forEach((node=>{node.dataset&&node.dataset.state&&loadState(node),checkNodes(node.childNodes)}))}function applyDataHide(){webui.querySelectorAll("[data-hide]").forEach((el=>{let sel=el.dataset.hide;if(!sel)return;let found=document.querySelector(sel);el.style.display=found?"":"none"}))}function checkDataStateMutations(mutations){updateActivity(),mutations.forEach((function(mutation){mutation.target&&mutation.target.dataset&&mutation.target.dataset.state&&function(node){let key=getNodeKey(node),state={};node.dataset.state.split("|").forEach((attr=>{let val=node.attributes[attr];val&&val.value&&"undefined"!==val.value&&(state[attr]=val.value)})),storage.setItem(key,JSON.stringify(state))}(mutation.target,mutation.attributeName),Array.from(mutation.addedNodes).forEach((el=>{el.dataset&&el.dataset.state&&loadState(el)}))})),applyDataHide()}function handleDataClick(ev){let key=ev.dataset.click;key&&webui.querySelectorAll(`[data-subscribe*="${key}:click"]`).forEach((sub=>{sub.click()}))}async function handleDataTrigger(ev){let el=ev.srcElement||ev.target||ev;if(ev.composedPath)for(let path of ev.composedPath())if(path.dataset&&path.dataset.trigger){el=path;break}let tick=0;if(el.nodeName.startsWith("APP-")||el.nodeName.startsWith("WEBUI-")){for(;void 0===el._isConnected&&++tick<100;)await webui.wait(10);if(!el._isConnected)return void webui.log.warn("Unexpected: Element is not connected",tick,el)}let key=el.dataset.trigger;key&&key.split("|").forEach((key=>{let oldData=webui.getData(key);if(-1!==key.indexOf(":")){let kp=key.split(":");key=kp[0];let getter=kp[1],value="function"==typeof el[getter]?el[getter]():webui.getDefined(el[getter],el.dataset[getter]);oldData!==value&&webui.setData(key,value)}else{let value=webui.getDefined("function"==typeof el.getValue?el.getValue():void 0,el.value,el.dataset.value);oldData!==value&&webui.setData(key,value)}}))}function setDataToEl(el,key,value){"string"==typeof key?key.split("|").forEach((key=>{let toSet=function(key){let toSet="setter";return el.dataset.subscribe.split("|").forEach((ds=>{let kts=ds.trim().split(":");key!==ds&&kts[0]!==key||2===kts.length&&(toSet=kts[1])})),toSet}(key=key.trim());if("click"===toSet)return;-1!==key.indexOf(":")&&(key=key.split(":")[0]);let a=0;!function attempt(){try{let isNull=null==(value=webui.getData(key));void 0===el.__setdata&&(el.__setdata={});let cv="string"==typeof value?webui.hashCode(value):webui.hashCode(JSON.stringify(value));if(el.__setdata[key]===cv)return;const pcv=el.__setdata[key];switch(el.__setdata[key]=cv,toSet){case"setter":let field=webui.toCamel(key),fsetter=webui.toCamel(`set-${field}`);"function"==typeof el[fsetter]?el[fsetter](value,key):"function"==typeof el[field]?el[field](value,key):"function"==typeof el.setValue&&a>1?el.setValue(value,key):-1!==["number","string","object"].indexOf(typeof el[fsetter])?el[fsetter]=value:-1!==["number","string","object"].indexOf(typeof el[field])?el[field]=value:a++<5?(el.__setdata[key]=pcv,setTimeout((()=>{attempt()}),Math.min(1e3,Math.pow(2,a)))):webui.hasSetter(el,"value")&&(el.value=value);break;case"text":case"innerText":isNull||(el.innerText=webui.applyAppDataToContent(value,!1,!0));break;case"html":case"innerHTML":isNull||(el.innerHTML=webui.applyAppDataToContent(value,!1,!0));break;default:if("function"==typeof el[toSet])el[toSet](value,key);else if(-1!==["number","string","object"].indexOf(typeof el[toSet]))el[toSet]=value;else if(a++<4)el.__setdata[key]=pcv,setTimeout((()=>{attempt()}),Math.min(1e3,Math.pow(2,a)));else switch(toSet){case"class":isNull?el.classList.remove(value):el.classList.add(value);break;case"src":case"href":case"value":case"style":case"theme":case"elevation":case"slot":isNull?el.removeAttribute(toSet):el.setAttribute(toSet,value);break;default:isNull?delete el.dataset[toSet]:el.dataset[toSet]=value}}}catch(ex){console.error(`Error setting data to ${el.nodeName}`,el,ex,key)}}()})):console.error("Invalid key for webui.setDataToEl",key,el)}function toggleAttr(el,attr){el.getAttribute(attr)?el.removeAttribute(attr):el.setAttribute(attr,!0)}function toggleClass(el,cls){el.classList.contains(cls)?el.classList.remove(cls):el.classList.add(cls)}function removeClass(el,cls){el.classList.contains(cls)&&el.classList.remove(cls)}function setAttr(el,attr,val){el.setAttribute(attr,val)}webui.fetchWithCache("https://cdn.myfi.ws/roles.json",!0).then((r=>{Object.assign(roles,r),Object.freeze(roles)})).catch((ex=>{webui.log.warn("Failed to load roles: %o",ex)}));let currentPageUrl="-";function changePage(url){if(url===currentPageUrl)return;currentPageUrl=url;const pageState={appData:JSON.stringify(watchedAppData)};window.history.pushState(pageState,document.title,url),loadPage()}function updateActivity(){lastActive=Date.now()}function checkForSubscription(node){if(!node||!node.getAttribute)return;let dataKey=node.getAttribute("data-subscribe");dataKey&&dataKey.split("|").forEach((dk=>{let dataKey=dk.split(":")[0];map.subs[dataKey]||(map.subs[dataKey]=[]),-1===map.subs[dataKey].indexOf(node)&&map.subs[dataKey].push(node),setDataToEl(node,dataKey)}))}function checkAttributeMutations(mutation){if("attributes"!==mutation.type)return;mutation.target&&"INPUT"===mutation.target.nodeName&&"hidden"===mutation.target.getAttribute("type")&&"value"===mutation.attributeName&&handleDataTrigger(mutation.target);applyAttributeSettings(mutation.target,mutation.attributeName)}function applyAttributeSettings(target,attr){if(webui.closest(target.parentNode,"webui-code,code,template"))return;if(!attr)return void(target&&"function"==typeof target.getAttribute&&["elevation","theme","data-subscribe","top","right","bottom","left"].forEach((attr=>{target.hasAttribute(attr)&&applyAttributeSettings(target,attr)})));let value=target.getAttribute(attr);switch(attr){case"top":target.style.top=webui.pxIfNumber(value);break;case"right":target.style.right=webui.pxIfNumber(value);break;case"bottom":target.style.bottom=webui.pxIfNumber(value);break;case"left":target.style.left=webui.pxIfNumber(value);break;case"data-subscribe":checkForSubscription(target);break;case"elevation":webui.removeClass(target,"elevation-"),value=parseInt(value)||0,value>0?target.classList.add(`elevation-${value}`):value<0&&target.classList.add("elevation-n"+-1*value);break;case"theme":"function"==typeof target.setTheme?target.setTheme(value):value?(target.style.setProperty("--theme-color",`var(--color-${value})`),target.style.setProperty("--theme-color-offset",`var(--color-${value}-offset)`)):(target.style.removeProperty("--theme-color"),target.style.removeProperty("--theme-color-offset"))}}function checkForSubscriptionAttr(node){checkForSubscription(node),webui.querySelectorAll("[data-subscribe]",node).forEach((node=>{checkForSubscription(node)}))}function removeNodeFromSubs(node){Object.keys(map.subs).forEach((key=>{let index=map.subs[key].indexOf(node);-1!==index&&map.subs[key].splice(index,1)}))}function checkDataSubscriptionMutations(mutations){mutations.forEach((function(mutation){checkAttributeMutations(mutation),"attributes"===mutation.type&&"data-subscribe"===mutation.attributeName&&checkForSubscription(mutation.target),Array.from(mutation.addedNodes).forEach((el=>{applyAttributeSettings(el),checkForSubscriptionAttr(el)})),Array.from(mutation.removedNodes).forEach((el=>{var node;(node=el).dataset&&node.dataset.subscribe&&removeNodeFromSubs(node),webui.querySelectorAll("[data-subscribe]",node).forEach((node=>{removeNodeFromSubs(node)}))}))}))}function transitionDelay(ms){return new Promise(((resolve,_)=>{setTimeout((()=>resolve()),ms)}))}function clearPageData(){Object.keys(watchedAppData).forEach((key=>{key.startsWith("app-")||key.startsWith("session-")||-1!==["page-path"].indexOf(key)||webui.setData(key,"")}))}let currentPage="",currentHash="";async function applyHash(){currentHash!==location.hash&&(currentHash=location.hash,""!==currentHash&&setTimeout((()=>{if(currentHash!==location.hash)return;let el=webui.querySelectorAll(`[hash="${currentHash.substring(1)}"]`)[0];el&&(-1!==["WEBUI-BUTTON","BUTTON"].indexOf(el.nodeName)?el.click():(el.focus(),el.scrollIntoView({behavior:"smooth"})))}),100))}async function loadPage(){if(!appSettings.app||!webui.appConfig.appName)return void setTimeout((()=>{loadPage()}),10);let page="/"===location.pathname?"/"+appSettings.rootPage:location.pathname,contentPage=page.toLowerCase();if(webui.appConfig.dynNavRoutes&&webui.appConfig.dynNavRoutes.length)for(let index=0;index<webui.appConfig.dynNavRoutes.length;++index)if(contentPage.startsWith(webui.appConfig.dynNavRoutes[index])){contentPage=webui.appConfig.dynNavRoutes[index];break}if(contentPage.endsWith("/")&&(contentPage=contentPage.substring(0,contentPage.length-1)),currentPage===contentPage)return void applyHash();currentPage=contentPage;let contentUrl=`${contentPage}${appSettings.contentExtension}${location.search}`;appSettings.encryptPageContent&&(contentUrl=function(url,encryption){if(!encryption)return url;if("base64"===encryption)return btoa(url);return url}(contentUrl,appSettings.encryptPageContent));let fullContentUrl=`${webui.getData("app-content-endpoint")}${contentUrl}`,fetchContent=fetch(fullContentUrl),fetchData=async function(){const pageDataEndpoint=webui.getData("app-data-endpoint");if(pageDataEndpoint){let data=await fetch(`${pageDataEndpoint}${dataUrl}`);return data.ok?await data.json():(webui.log.warn("Returned page data was not ok for %o",dataUrl),{})}return{}}();appSettings.app.main.classList.add("transition"),webui.setData("page-path",page);let timerStart=Date.now();try{let contentResult=await fetchContent;if(!contentResult.ok)throw Error("Returned page content was not ok");let body=await contentResult.text(),elapsed=Date.now()-timerStart;if(elapsed<300&&await transitionDelay(300-elapsed),appSettings.app.setPageContent("",watchedAppData,fullContentUrl),clearPageData(),body.startsWith("<!DOCTYPE"))throw Error(`Invalid page content loaded from ${fullContentUrl}`);let content=webui.applyAppDataToContent(body);appSettings.app.setPageContent(content,watchedAppData,fullContentUrl),setTimeout((()=>{checkNodes(document.body.childNodes),applyHash()}),100)}catch(ex){webui.log.error("Failed loading page content",ex);let elapsed=Date.now()-timerStart;elapsed<300&&await transitionDelay(300-elapsed),clearPageData(),appSettings.app.setPageContent("<webui-page-not-found></webui-page-not-found>",watchedAppData)}try{let data=await fetchData;webui.setData("page-data",data),data.forEach||Object.keys(data).forEach((key=>{webui.setData(key,data[key])}))}catch(ex){console.error("Failed loading page data",ex)}let elapsed=Date.now()-timerStart;elapsed<300?await transitionDelay(300-elapsed):await transitionDelay(100),appSettings.app.main.classList.remove("transition")}const appPrefix="APP-",wuiPrefix="WEBUI-",wcLoading={},wcLoaded={},appLoaded={},wcRoot="3180"===location.port?"":"https://cdn.myfi.ws/",wcMin=".min";function processNode(nodeName){if(wcLoading[nodeName])return;wcLoading[nodeName]=!0;let wc=nodeName.split("-").splice(1).join("-").toLowerCase();nodeName.startsWith(appPrefix)?function(wc){if(appLoaded[wc])return;appLoaded[wc]=!0;let script=webui.create("script");script.setAttribute("async",!0),script.setAttribute("src",`${webui.appSrc}/${wc}${webui.appMin}.js`),document.head.append(script)}(wc):loadWebUIComponent(wc)}function loadWebUIComponent(wc){if(wcLoaded[wc])return;wcLoaded[wc]=!0;let script=webui.create("script");script.setAttribute("async",!0),script.setAttribute("src",`${wcRoot}webui/${wc}${wcMin}.js`),document.head.append(script)}function componentPreload(el){if(!el)return;(el.nodeName.startsWith(wuiPrefix)||el.nodeName.startsWith(appPrefix))&&processNode(el.nodeName);let pl=el.getAttribute("preload");pl&&pl.replace(";"," ").replace(","," ").split(" ").forEach(loadWebUIComponent)}function checkAddedNode(el){applyAttributeSettings(el),el.shadowRoot&&(el._isObserved||(el._isObserved=1,startObserving(el.shadowRoot)),checkNodes(el.shadowRoot.childNodes)),(el.nodeName&&el.nodeName.startsWith(wuiPrefix)||el.nodeName.startsWith(appPrefix))&&processNode(el.nodeName),checkNodes(el.childNodes)}function checkNodes(nodes){0!==nodes.length&&nodes.forEach((node=>{checkAddedNode(node)}))}const startObserving=domNode=>{const observer=new MutationObserver((mutations=>{checkDataStateMutations(mutations),checkDataSubscriptionMutations(mutations),mutations.forEach((function(mutation){!function(mutation){checkAttributeMutations(mutation);let nodeName=mutation.target.nodeName;(nodeName.startsWith(wuiPrefix)||nodeName.startsWith(appPrefix))&&"attributes"===mutation.type&&"preload"===mutation.attributeName&&componentPreload(mutation.target),Array.from(mutation.addedNodes).forEach((el=>{checkAddedNode(el)}))}(mutation)}))}));return observer.observe(domNode,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),observer};return function runWhenBodyIsReady(setup){document.body&&webui.loaded?setup():setTimeout((()=>runWhenBodyIsReady(setup)),1)}((()=>{checkNodes(document.childNodes),applyDataHide(),webui.querySelectorAll("[data-subscribe]").forEach((el=>{setDataToEl(el,el.dataset.subscribe)})),webui.querySelectorAll("[theme]").forEach((el=>{applyAttributeSettings(el,"theme")})),webui.querySelectorAll("[elevation]").forEach((el=>{applyAttributeSettings(el,"elevation")})),["app-config","app","data"].forEach((preload=>{componentPreload(document.querySelector(`webui-${preload}`))})),startObserving(document.body),checkForSubscriptionAttr(document.body),loadPage(),loadWebUIComponent("alert"),loadWebUIComponent("content"),document.body.addEventListener("input",handleDataTrigger),document.body.addEventListener("change",handleDataTrigger),document.body.addEventListener("click",(ev=>{let target=ev.composedPath?ev.composedPath()[0]:ev.target,retValue=!0,breakAtEnd=!1,applyDynStyles=!1;function stop(){ev.stopPropagation(),ev.preventDefault(),retValue=!1,breakAtEnd=!0}for(;!breakAtEnd&&target!==document.body&&null!=target;){if(!target.hasAttribute){target=target.parentNode||target.host;continue}if(target.hasAttribute&&target.hasAttribute("disabled")&&"false"!==target.getAttribute("disabled")&&!ev.ctrlKey)return ev.stopPropagation(),ev.preventDefault(),!1;target.dataset.click&&(stop(),handleDataClick(target)),target.dataset.trigger&&-1!==["A","BUTTON","WEBUI-BUTTON"].indexOf(target.nodeName)&&(stop(),handleDataTrigger(target));let href=target.getAttribute("href");if(href&&-1!==href.indexOf(":")&&"http"!==href.substr(0,4))return!0;if(!href||"blank"===target.getAttribute("target")||"/"!==href[0]&&"http"===href.substr(0,4)||(stop(),changePage(href)),target.hasAttribute("data-stopclick")&&stop(),target.dataset.setattr){let[val,attr,sel]=target.dataset.setattr.split("|").reverse();sel?webui.querySelectorAll(sel).forEach((el=>{setAttr(el,attr,val)})):setAttr(target,attr,val),applyDynStyles=!0;break}if(target.dataset.toggleclass){let[cls,sel]=target.dataset.toggleclass.split("|").reverse();sel?webui.querySelectorAll(sel).forEach((el=>toggleClass(el,cls))):toggleClass(target,cls),applyDynStyles=!0;break}if(target.dataset.removeclass&&(target.dataset.removeclass.split(";").forEach((ds=>{let[cls,sel]=ds.split("|").reverse();sel?webui.querySelectorAll(sel).forEach((el=>removeClass(el,cls))):removeClass(target,cls)})),applyDynStyles=!0),target.dataset.toggleattr){let[attr,sel]=target.dataset.toggleattr.split("|").reverse();sel?webui.querySelectorAll(sel).forEach((el=>toggleAttr(el,attr))):toggleAttr(target,attr),applyDynStyles=!0}if(applyDynStyles){webui.applyDynamicStyles();break}target=target.parentNode||target.host}return retValue}))})),window.addEventListener("keydown",updateActivity),window.addEventListener("click",updateActivity),window.addEventListener("scroll",updateActivity),window.addEventListener("popstate",(ev=>{if(changePage(`${location.pathname}${location.hash}${location.search}`),ev.state&&ev.state.appData){const appData=JSON.parse(ev.state.appData);Object.keys(appData).forEach((key=>{-1===["page-path","page-title","page-subtitle"].indexOf(key)&&(watchedAppData[key]=appData[key])})),Object.keys(watchedAppData).forEach((key=>{-1===Object.keys(appData).indexOf(key)&&delete watchedAppData[key]}))}})),window.addEventListener("load",(()=>{function errorHandler(event){event.preventDefault();const message=function(event){return event.reason&&event.reason.message?`Unhandled Promise Rejection: ${event.reason.message||event.reason}\nStack: ${event.reason.stack}`:`Unhandled Error: ${event.message}\nSource: ${event.filename}:${event.lineno}:${event.colno}`}(event);return webui.alert(message,"danger"),!0}window.addEventListener("error",errorHandler),window.addEventListener("unhandledrejection",errorHandler)})),window.throwTestError=()=>{throw new Error("This is a simulated uncaught error!")},window.addEventListener("resize",(ev=>{webui.applyDynamicStyles(),Object.keys(resizeSubscribers).forEach((key=>{resizeSubscribers[key](ev)}))})),function applyDynamicStylesTimer(){webui.applyDynamicStyles(),setTimeout((()=>applyDynamicStylesTimer()),1e3)}(),webui})();setTimeout((()=>{void 0===window.tooltipsEnabled&&(window.tooltipsEnabled=!0);const Tooltip=webui.create("div");Tooltip.className="tooltip closed";let capturedElement=null;document.body.appendChild(Tooltip);let isShowing=!1;function CloseIfOpen(){isShowing&&(isShowing=!1,capturedElement=null,Tooltip.className="tooltip closed")}document.body.addEventListener("click",CloseIfOpen),document.body.addEventListener("input",CloseIfOpen),document.body.addEventListener("mousemove",(ev=>{if(!window.tooltipsEnabled)return;let[target,display]=function(target){for(;target&&target!==target.parentNode;){if(!target.getAttribute){target=target.parentNode||target.host;continue}let title=target.getAttribute("title");title&&"null"!=title?(target.setAttribute("aria-label",title),target.removeAttribute("title")):"null"===title&&target.removeAttribute("title");let ariaLabel=target.getAttribute("aria-label");if(ariaLabel)return[target,ariaLabel];target=target.parentNode||target.host}return[null,null]}(ev.composedPath()[0]);if(!target)return void CloseIfOpen();if(target===capturedElement)return;let client=target.getBoundingClientRect();if(isShowing=!0,`${target.innerText}`.trim()===display&&!webui.isTextOverflowing(target))return;capturedElement=target,Tooltip.innerText=display,Tooltip.className="tooltip open";let myposition={x:client.left+client.width/2-Tooltip.clientWidth/2,y:client.top-30};myposition.x+Tooltip.clientWidth>window.innerWidth&&(myposition.x=window.innerWidth-Tooltip.clientWidth-10),myposition.x<0&&(myposition.x=10),myposition.y<0&&(myposition.y=client.top+client.height),Tooltip.style.left=`${myposition.x}px`,Tooltip.style.top=`${myposition.y}px`}))}),100);