"use strict";{const t={gfm:!0},e={"app-name":"App","company-singular":"Company","company-possessive":"Company's","page-title":"","page-subtitle":"",domain:location.hostname.toLowerCase()},n={rootPage:"root",contentExtension:".md",pageContentEndpoint:"/d/en-US",pageDataEndpoint:"https://api.myfi.ws/data/page/",encryptPageContent:!1,encryptPageData:"base64"};function applyAppDataToContent(n){return Object.keys(e).forEach(t=>{let a=`{${t.replace(/-/g,"_").toUpperCase()}}`,o=e[t],i=0;for(;-1!==n.indexOf(a)&&i<1e3;)++i,n=n.replace(a,o)}),marked.parse(n,t)}window.webuiApplyAppData=applyAppDataToContent;{function getStorage(){return localStorage.storage_accepted?localStorage:sessionStorage}function getNodeKey(t){let e=[];return e.push(t.nodeName.toLowerCase()),t.classList.length&&e.push(t.classList[0]),["id","name"].forEach(n=>{let a=t.attributes[n];a&&a.value&&e.join(`${n}-${a.value}`)}),e.join("_")}function saveState(t){let e=getStorage(),n=getNodeKey(t),a={};t.dataset.state.split("|").forEach(e=>{let n=t.attributes[e];n&&n.value&&"undefined"!==n.value&&(a[e]=n.value)}),e[n]=JSON.stringify(a)}function loadState(t){let e=getStorage(),n=getNodeKey(t);if(!e[n])return;let a=JSON.parse(e[n]);t.dataset.state.split("|").forEach(e=>{a[e]&&t.setAttribute(e,a[e])})}function checkNodes(t){0!==t.length&&t.forEach(t=>{t.dataset&&t.dataset.state&&loadState(t),checkNodes(t.childNodes)})}function applyDataHide(){document.querySelectorAll("[data-hide]").forEach(t=>{let e=t.dataset.hide;if(!e)return;let n=document.querySelector(e);t.style.display=n?"":"none"})}const t=t=>{const e=new MutationObserver(t=>{t.forEach(function(t){t.target&&t.target.dataset&&t.target.dataset.state&&saveState(t.target),Array.from(t.addedNodes).forEach(t=>{t.dataset&&t.dataset.state&&loadState(t)})}),applyDataHide()});return e.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),e};t(document.body),checkNodes(document.childNodes),applyDataHide()}{function handleDataClick(t){let e=t.dataset.click;e&&document.querySelectorAll(`[data-subscribe="${e}"][data-set="click"]`).forEach(t=>{t.click()})}function handleDataTrigger(t){let e=t.srcElement||t.target,n=e.dataset.trigger;if(!n)return;let a=e.value;dataChanged(n,a)}function setDataToEl(t,n){let a=t.dataset.set||n,o=e[n];if(null!=o)switch(a){case"innerText":t.innerText=e[n];break;case"innerHTML":t.innerHTML=e[n];break;default:t.setAttribute(a,e[n])}}function camelToSnake(t){return t.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function dataChanged(t,n){t=camelToSnake(t),null==n?delete e[t]:e[t]="string"==typeof n?n:JSON.stringify(n),document.querySelectorAll(`[data-subscribe="${t}"]`).forEach(e=>{setDataToEl(e,t)})}function toggleAttr(t,e){t.getAttribute(e)?t.removeAttribute(e):t.setAttribute(e,!0)}function toggleClass(t,e){t.classList.contains(e)?t.classList.remove(e):t.classList.add(e)}function removeClass(t,e){t.classList.contains(e)&&t.classList.remove(e)}function setAttr(t,e,n){t.setAttribute(e,n)}function changePage(t){window.history.pushState(e,document.title,t),loadPage(t)}window.webuiSetData=dataChanged,window.addEventListener("popstate",t=>{t.state&&console.log("TODO: handle history updates",t)}),document.body.addEventListener("input",handleDataTrigger),document.body.addEventListener("change",handleDataTrigger),document.body.addEventListener("click",t=>{let e=t.target;for(;e!==document.body;){let n=e.getAttribute("href");if(e.dataset.click)return handleDataClick(e),t.stopPropagation(),t.preventDefault(),!1;if(n&&"blank"!==e.getAttribute("target")&&("/"===n[0]||"http"!==n.substr(0,4)))return changePage(n),t.stopPropagation(),t.preventDefault(),!1;if(e.hasAttribute("data-stopclick"))return t.stopPropagation(),t.preventDefault(),!1;if(e.dataset.setattr){let[t,n,a]=e.dataset.setattr.split("|").reverse();a?document.querySelectorAll(a).forEach(e=>{setAttr(e,n,t)}):setAttr(e,n,t),i();break}if(e.dataset.toggleclass){let[t,n]=e.dataset.toggleclass.split("|").reverse();n?document.querySelectorAll(n).forEach(e=>toggleClass(e,t)):toggleClass(e,t),i();break}if(e.dataset.removeclass&&(e.dataset.removeclass.split(";").forEach(t=>{let[n,a]=t.split("|").reverse();a?document.querySelectorAll(a).forEach(t=>removeClass(t,n)):removeClass(e,n)}),i()),e.dataset.toggleattr){let[t,n]=e.dataset.toggleattr.split("|").reverse();n?document.querySelectorAll(n).forEach(e=>toggleAttr(e,t)):toggleAttr(e,t),i();break}e=e.parentNode}});const t=t=>{const e=new MutationObserver(t=>{t.forEach(function(t){Array.from(t.addedNodes).forEach(t=>{if(!t||!t.getAttribute)return;let e=t.getAttribute("data-subscribe");e&&setDataToEl(t,e)})})});return e.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),e};t(document.body),document.querySelectorAll("[data-subscribe]").forEach(t=>{let e=t.dataset.subscribe;setDataToEl(t,e)})}function transitionDelay(t){return new Promise((e,n)=>{setTimeout(()=>e(),t)})}async function loadPage(){let t="/"===location.pathname?"/"+n.rootPage:location.pathname,e=t+location.search,a=encryptUrl(e,n.encryptPageData),o=encryptUrl(e,n.encryptPageContent),i=`${n.pageContentEndpoint}${o}${n.contentExtension}`,s=fetch(i),r=fetch(`${n.pageDataEndpoint}${a}`);n.app.main.classList.add("transition");let l=Date.now();try{let t=await s;if(!t.ok)throw Error("Returned page content was not ok");let e=await t.text(),a=Date.now()-l;a<300&&await transitionDelay(300-a),n.app.setPageContent(e,i)}catch(t){console.error("Failed loading page content",t);let e=Date.now()-l;e<300&&await transitionDelay(300-e),n.app.setPageContent("<webui-page-not-found></webui-page-not-found>")}try{let t=await r;if(!t.ok)throw Error("Returned page data was not ok");await t.json()}catch(t){console.error("Failed loading page data",t)}let d=Date.now()-l;d<300?await transitionDelay(300-d):await transitionDelay(100),n.app.main.classList.remove("transition")}function encryptUrl(t,e){if(!e)return t;switch(e){case"base64":return btoa(t);default:return t}}const a=document.createElement("template");a.setAttribute("shadowrootmode",!0),a.innerHTML='\n<style type="text/css">\n:host {\nbackground-color: var(--site-background-color, white);\ncolor: var(--site-background-offset, black);\ndisplay: grid;\ngrid-template-columns: min-content auto min-content;\ngrid-template-rows: min-content min-content auto min-content min-content;\nposition: fixed;\nleft: 0;\ntop: 0;\nwidth: 100%;\nheight: 100%;\nmax-width: 100%;\nmax-height: 100%;\noverflow: hidden;\n}\n::slotted([slot="header"]) {\ngrid-row: 2;\ngrid-column: 2;\ndisplay: flex!important;\nalign-items: start;\njustify-items: start;\nfont-size: 1.2rem;\ngap:var(--padding, 1em);\npadding:var(--padding,1em);\nheight:min-content;\nmax-height:min-content;\n}\n::slotted([slot="footer"]) {\ngrid-row: 4;\ngrid-column: 2;\ndisplay: flex!important;\nfont-size: 0.8rem;\nalign-items:center;\npadding:var(--padding, 1em);\nvertical-align:middle;\ngap:var(--padding, 1em);\nheight:min-content;\nmax-height:min-content;\n}\n::slotted([slot="left"]) {\ngrid-column: 1;\nz-index: 10;\n}\n::slotted([slot="right"]) {\ngrid-column: 3;\nz-index: 11;\n}\n::slotted([slot="bottom"]) {\nheight:min-content;\ngrid-row: 5;\nz-index: 12;\n}\n::slotted([slot="top"]) {\nheight:min-content;\ngrid-row: 1;\nz-index: 13;\n}\n::slotted([slot="left"]),\n::slotted([slot="right"]) {\nmax-width: calc(0.5 * var(--window-width));\ngrid-row: 2/5;\ndisplay: flex!important;\nflex-direction: column;\n}\n::slotted([slot="top"]),\n::slotted([slot="bottom"]) {\nmax-height: calc(0.5 * var(--window-height));\ngrid-column: 2;\n}\n::slotted(:not([slot])) {\n}\nmain {\ndisplay:block;\noverflow:auto;\nbox-sizing:border-box;\nheight:var(--main-height);\nflex-grow:1;\npadding:var(--padding,1em);\ngrid-row: 3;\ngrid-column: 2;\ntransition:\nopacity 0.4s ease-out,\ntransform 0.4s ease-out\n;\n}\nmain.transition {\ntransform:rotateY(90deg);\nopacity:0;\n}\n::-webkit-scrollbar {\nwidth: 1em;\nheight: 1em;\n}\n::-webkit-scrollbar-thumb {\nbackground: rgba(90, 90, 90, 0.2);\n}\n::-webkit-scrollbar-track {\nbackground: rgba(0, 0, 0, 0.2);\n}\n</style>\n<slot name="header"></slot>\n<main><slot></slot></main>\n<slot name="footer"></slot>\n<slot name="left"></slot>\n<slot name="right"></slot>\n<slot name="top"></slot>\n<slot name="bottom"></slot>\n<webui-dialogs></webui-dialogs>\n';let o="",i=()=>{};window.addEventListener("resize",t=>{i()});class s extends HTMLElement{constructor(){super(),n.app=this;const t=this.attachShadow({mode:"open"});this.dynstyles=document.createElement("style"),this.dynstyles.setAttribute("type","text/css"),this.template=a.content.cloneNode(!0),this.headerSlot=this.template.querySelector("slot[name=header]"),this.footerSlot=this.template.querySelector("slot[name=footer]"),this.leftPanelSlot=this.template.querySelector("slot[name=left]"),this.rightPanelSlot=this.template.querySelector("slot[name=right]"),this.topPanelSlot=this.template.querySelector("slot[name=top]"),this.bottomPanelSlot=this.template.querySelector("slot[name=bottom]"),this.main=this.template.querySelector("main"),this.mainSlot=this.template.querySelector("main>slot"),t.appendChild(this.template),document.head.appendChild(this.dynstyles),this.getAttribute("preload")||this.setAttribute("preload","dialogs"),i=(()=>{this.applyDynamicStyles()}),this.applyDynamicStylesTimer(),setTimeout(()=>loadPage(),10)}static get observedAttributes(){return["page-content","page-data","page-content-encrypt","page-data-encrypt","root-page","content-extension"]}attributeChangedCallback(t,e,a){if(e!==a)switch(null==a?delete this[t]:this[t]=a,t){case"root-page":n.rootPage=a;break;case"content-extension":n.contentExtension=a;break;case"page-content":n.pageContentEndpoint=a;break;case"page-data":n.pageDataEndpoint=a;break;case"page-data-encrypt":n.encryptPageData=a;break;case"page-content-encrypt":n.encryptPageContent=a}}setPageContent(t,n){if(!window.marked)return void setTimeout(()=>this.setPageContent(t),10);if(this.mainSlot.assignedElements().forEach(t=>{t.remove()}),Object.keys(e).forEach(t=>{t.startsWith("page-")&&webuiSetData(t,"")}),t.startsWith("<!DOCTYPE"))return void console.error("Invalid page content loaded:",n);t=applyAppDataToContent(t);let a=document.createElement("div");a.innerHTML=t,a.childNodes.forEach(t=>{this.appendChild(t)})}connectedCallback(){}disconnectedCallback(){}getSlot(t){let e=null;return this.childNodes.forEach(n=>{n.slot===t&&(e=n)}),e}setBodyClasses(){let t=window.innerWidth,e=t>3800?"w-4k":t>3400?"w-wqhd":t>2500?"w-qhd":t>1900?"w-fhd":t>1500?"w-hdp":t>1300?"w-hd":t>500?"w-tab":"w-mob",n=!1;document.body.classList.forEach(t=>{t.startsWith("w-")&&t!==e?document.body.classList.remove(t):t===e&&(n=!0)}),n||document.body.classList.add(`${e}`)}applyDynamicStyles(){this.setBodyClasses();let t=this.getSlot("header")||{clientHeight:0},e=this.getSlot("footer")||{clientHeight:0},n=this.getSlot("top")||{clientHeight:0},a=this.getSlot("right")||{clientWidth:0},i=this.getSlot("bottom")||{clientHeight:0},s=this.getSlot("left")||{clientWidth:0},r=this.shadowRoot.children[2],l=window,d=document.body,c=l.innerWidth||d.clientWidth,h=l.innerHeight||d.clientHeight,g=r.clientWidth,p=h-(t.clientHeight+e.clientHeight+n.clientHeight+i.clientHeight),u=`\n        :root {\n        --window-width: ${c}px;\n        --window-height: ${h}px;\n        --main-width: ${g}px;\n        --main-height: ${p}px;\n        --header-height: ${t.clientHeight}px;\n        --footer-height: ${e.clientHeight}px;\n        --drawer-left-width: ${s.clientWidth}px;\n        --drawer-right-width: ${a.clientWidth}px;\n        --drawer-top-height: ${n.clientHeight}px;\n        --drawer-bottom-height: ${i.clientHeight}px;\n        }\n        `;o!==u&&(o=u,this.dynstyles.innerHTML=u)}applyDynamicStylesTimer(){i(),setTimeout(()=>this.applyDynamicStylesTimer(),1e3)}}customElements.define("webui-app",s)}