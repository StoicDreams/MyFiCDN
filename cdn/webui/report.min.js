"use strict";{const tableContent='\n<webui-table theme="inherit" columns="[columns]" bordered class="my-3">\n[innerhtml]\n</webui-table>\n',pagination='<webui-pagination class="my-a" data-subscribe loop max-pages="3"></webui-pagination>';function getReportHtml(report){report.data;const phtml=pagination.replace(/\[id\]/g,report._id).replace("data-subscribe",`data-subscribe="pag-${report._id}-index:setValue|pag-${report._id}-report:setData"`);let columns=report.appendColumns?`${report.columns};${report.appendColumns}`:report.columns,chtml=tableContent.replace(/\[id\]/g,report._id).replace("[innerhtml]",report._tableActions).replace("[columns]",columns);return report.bordered||(chtml=chtml.replace("bordered ","")),chtml=report.label?`<webui-grid theme="inherit" columns="auto max-content">\n<h3>${report.label}</h3>${phtml}\n</webui-grid>${chtml}${phtml}`:`${phtml}${chtml}${phtml}`,report.theme&&-1!==["info","success","warning","danger","primary","secondary","tertiary","white","black","shade","background","active","title"].indexOf(report.theme)&&(chtml=chtml.replace(/"inherit"/g,`"${report.theme}"`)),chtml}function createError(message){return webui.create("webui-alert",{variant:"danger",html:message,show:!0})}webui.define("webui-report",{content:!0,watchVisibility:!1,isInput:!1,preload:"",perPage:10,page:1,data:[],columns:"",sortOrder:"asc",sortColumn:"",constructor:t=>{t._id=webui.uuid(),t._tableActions=t.innerHTML},flags:["bordered"],attr:["height","max-height","label","api","per-page","columns","append-columns","sort-order","sort-column","theme","filters"],attrChanged:(t,property,value)=>{switch(property){case"api":t._isRendered&&setTimeout((()=>{t.loadData()}),1);break;case"height":t.style.height=webui.pxIfNumber(value);break;case"maxHeight":t.style.maxHeight=webui.pxIfNumber(value)}},connected:function(t){t.setupComponent()},disconnected:function(t){},reconnected:function(t){},setupComponent:function(){this.render()},loadData:function(){const t=this;if(!t.sortColumn)return void t.appendChild(createError("Report is missing default sort-column"));if(t.sortOrder||(t.sortOrder="asc"),!t.api)return void t.appendChild(createError("Report is missing api"));let request={perPage:t.perPage,page:t.page,sortColumn:t.sortColumn,sortOrder:t.sortOrder};if(t.filters){let filters=webui.getData(t.filters);Object.assign(request,filters)}let json=JSON.stringify(request);t._req!==json&&(t._req=json,setTimeout((()=>{t._req===json&&webui.fetchApi(t.api,request).then((async resp=>{if(t._req===json)if(200===resp.status){const data=await resp.json();!t.columns&&data.columns&&(t.appendColumns?t._table.setAttribute("columns",`${data.columns};${t.appendColumns}`):t._table.setAttribute("columns",data.columns)),t._table.setData(data.items),t._pag.forEach((p=>{p.perPage=t.perPage,p.pageCount=data.pageCount,p.totalCount=data.total,p.setValue(data.page)}))}else{let ex=await resp.text();ex||401!==resp.status||(ex="You are not authorized to view this report"),t.appendChild(createError(`API Error: ${ex}`))}})).catch((ex=>{t.appendChild(createError(`API Error: ${ex}`))}))}),400))},setPage:function(page){const t=this;page&&page!==t.page&&(t.page=page,t.loadData())},render:function(){const t=this;t.innerHTML=getReportHtml(t),t.loadData(),t._table=t.querySelector("webui-table"),t._pag=t.querySelectorAll("webui-pagination");let ds=[];ds.push(`pag-${t._id}-index:setPage`),t.filters&&ds.push(`${t.filters}:loadData`),t.setAttribute("data-subscribe",ds.join("|")),t._isRendered=!0}})}