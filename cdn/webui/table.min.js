/*!
 * Web UI Table - https://webui.stoicdreams.com/components#table
 * A component for displaying data in tables within the web UI.
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2024-2025 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
{function getAlign(val){let flagStart=0,flagEnd=0;return":"===(val=val.trim())[0]&&(flagStart=1,val=val.substr(1)),":"===val.substr(val.length-1)&&(flagEnd=1,val=val.substr(0,val.length-1)),[val.trim(),flagStart?flagEnd?"text-center":"text-left":flagEnd?"text-right":"text-justify"]}webui.define("webui-table",{_columns:[],linkCss:!0,columnFormats:{},constructor:t=>{t._table=webui.create("table"),t._columnTemplates={},webui.removeElements(t,'[slot="column"]',(n=>{let key=n.dataset.name||n.dataset.key||n.getAttribute("name")||n.getAttribute("key");void 0!==key&&(t._columnTemplates[key]=n.innerHTML)}))},attr:["bordered","columns","sortable","current-sort","current-sort-dir","column-formats"],attrChanged:(t,property,value)=>{switch(property){case"bordered":t._table.classList.add("bordered");break;case"columnFormats":if(t.columnFormats={},"string"==typeof value){let cf={};value.split(";").forEach((c=>{let cv=c.split(":");cf[cv[0]]=cv[1]||"text"})),Object.assign(t.columnFormats,cf)}break;case"columns":t._columns=[],value.split(";").forEach((c=>{(c=c.trim())&&t._columns.push(webui.replaceAppData(c))})),t.render()}},setData:function(data){const t=this;"string"==typeof(data=data||{})&&(data=JSON.parse(data));let json=JSON.stringify(data);t._dataJson!==json&&(t._dataJson=json,t._data=data,t.render())},render:function(){const t=this;t._table.innerHTML="";let h=webui.create("tr");t._table.appendChild(h);let sortable={};t.sortable&&(t.sortable.split(";").forEach((col=>{let dsb=(col=col.split(":")).length>1?col[1]:"asc";col.length>2&&(t.defaultSort=col[0],t.defaultSortDir=dsb),col=col[0],sortable[col]=dsb,t.defaultSort||(t.defaultSort=col,t.defaultSortDir=dsb)})),t.defaultSort&&!t.currentSort&&(t.currentSort=t.defaultSort,t.currentSortDir=t.defaultSortDir)),t._columns.forEach((col=>{let cs=col.split("|"),[display,align]=getAlign(cs[0].trim()),key=cs.length>1?cs[1].trim():display,th=webui.create("th",{class:align});if(sortable[key]){let flexAlign="text-center"===align?"center":"text-right"===align?"right":"left",c=webui.create("webui-flex",{align:"center",justify:flexAlign,gap:1,class:"no-select"});if(c.style.cursor="pointer",c.appendChild(webui.create("span",{html:display})),t.currentSort===key){let ico=webui.create("webui-icon",{icon:"asc"===t.currentSortDir?"caret|has-shadow:true|fill|rotate:0":"caret|has-shadow:true|fill|rotate:180"});c.appendChild(ico)}c.addEventListener("click",(_=>{let sortDir=t.currentSort===key?"asc"===t.currentSortDir?"desc":"asc":sortable[key];t.currentSort=key,t.currentSortDir=sortDir,t.dispatchEvent(new Event("update-sort",{bubbles:!0,composed:!0}))})),th.appendChild(c)}else th.innerHTML=webui.replaceAppData(display);h.appendChild(th)})),t._data&&t._data.forEach&&t._data.forEach((row=>{row._rowId||(row._rowId=webui.toCamel(webui.uuid()).toLowerCase(),webui.setData(`page-tr-${row._rowId}`,row));let tr=webui.create("tr");t._table.appendChild(tr),t._columns.forEach((col=>{let cd=(col=col.trim()).split("|"),[cm,align]=getAlign(cd[0]);2===cd.length&&(cm=cd[1].trim());let cc=webui.toCamel(cm),pc=webui.toPascel(cm),td=webui.create("td",{class:align});tr.appendChild(td);let content="";if(t._columnTemplates[cm])content=webui.replaceAppData(t._columnTemplates[cm],row);else if(t._columnTemplates[cc])content=webui.replaceAppData(t._columnTemplates[cc],row);else if(t._columnTemplates[pc])content=webui.replaceAppData(t._columnTemplates[pc],row);else{let data=webui.getDefined(row[cm],row[cc],row[pc],"");content=webui.replaceAppData(`${data}`)}if("html"===webui.getDefined(t.columnFormats[cm],t.columnFormats[cc],t.columnFormats[pc],void 0))td.innerHTML=content;else td.innerText=content}))}))},connected:t=>{t.appendChild(t._table),t.render(),setTimeout((()=>{if(t.dataset.subscribe){let data=webui.getData(t.dataset.subscribe);data!==t._data&&t.setData(data)}}),1)},shadowTemplate:'\n<slot name="column"></slot>\n<slot></slot>\n<style type="text/javascript">\n:host {\ndisplay:block;\nwidth:100%;\nwidth:-webkit-fill-available;\n}\nslot[name="column"] {\ndisplay:none;\n}\n</style>\n'})}