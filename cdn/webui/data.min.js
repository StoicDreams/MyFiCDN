/*!
 * Web UI Data - https://webui.stoicdreams.com
 * A component for managing data within the web UI.
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2024-2025 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
"use strict";{function extractJSON(template,key){if(!key&&!(key=template.getAttribute("name")))return;if(webui.getData(key))return{key:key,value:void 0};let value=template.innerHTML;try{return value=JSON.parse(value),{key:key,value:value}}catch(ex){console.error("Failed to parse JSON from template data",value,t)}}function extractHTML(template,key){if(!key&&!(key=template.getAttribute("name")))return;if(webui.getData(key))return;let value=template.innerHTML;return value=webui.trimLinePreWhitespce(value),{key:key,value:value}}function extractText(template,key){if(!key&&!(key=template.getAttribute("name")))return;if(webui.getData(key))return;let value=template.innerHTML;return value=webui.trimLinePreWhitespce(value),{key:key,value:value}}webui.define("webui-data",{constructor:t=>{t._slot=t.template.querySelector("slot:not([name])"),t._slotHtml=t.template.querySelector('slot[name="html"]'),t._slotText=t.template.querySelector('slot[name="text"]'),t._slotJson=t.template.querySelector('slot[name="json"]')},connected:t=>{t._slotText.assignedElements().forEach((template=>{let{key:key,value:value}=extractText(template);key&&value&&webui.setData(key,value)})),t._slotHtml.assignedElements().forEach((template=>{let{key:key,value:value}=extractHTML(template);key&&value&&webui.setData(key,value)})),t._slotJson.assignedElements().forEach((template=>{let{key:key,value:value}=extractJSON(template);key&&value&&webui.setData(key,value)})),Object.keys(t.dataset).forEach((key=>{switch(key){case"subscribe":case"trigger":case"click":return}let value=t.dataset[key];try{value=JSON.parse(value)}catch(ex){}webui.setData(key,value)}))},pushItem:function(value,key){if(!key||!value)return;let template=this.querySelector('template[slot="json"][data-update]');if(!template)return void console.error('pushItem subscriptions should have an associated template[slot="json"][data-update="key-of-array-to-update"] template.');let setKey=template.dataset.update;if(!setKey)return void console.error("[data-update] does not have a valid value");webui.setData(key,void 0);let data=webui.getData(setKey);data?"function"==typeof data.push?(data.push(value),webui.setData(setKey,data)):console.error("Data not in expected format",setKey,data):console.error("Data not found for key",setKey)},setDefault:function(value,key){if(webui.getData(key))return;if(value)return;let template=this.querySelector(`template[name="${key}"]`);if(!template)return void console.error("Expected template not found for key",key);let slot=template.getAttribute("slot");if(slot)try{let result;switch(slot){case"json":result=extractJSON(template,key);break;case"html":result=extractHTML(template,key);break;case"text":result=extractText(template,key)}void 0!==result&&void 0!==result.key&&void 0!==result.value&&webui.setData(result.key,result.value)}catch(ex){console.error(ex)}else console.error("Templates in webui-data require a slot assignment")},shadowTemplate:'\n<slot name="html"></slot>\n<slot name="text"></slot>\n<slot name="json"></slot>\n<slot></slot>\n<style type="text/css">\n:host {\ndisplay:none;\n}\n</style>\n'})}