/*!
 * Web UI Nav - https://webui.stoicdreams.com/components#webui-nav
 * A component for displaying and managing navigation links within the web UI.
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2024-2025 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
"use strict";{const show={},sessionKey="session-nav-show";webui.define("webui-nav",{preload:"fa paper nav-group nav-link",attr:["routes","nav-routes"],attrChanged:(t,property,value)=>{switch(property){case"routes":t.loadRoutes(value);break;case"navRoutes":t.buildNav(value)}},connected:t=>{t.userRole=0,t.addDataset("subscribe","session-user-role:setUserRole"),t._buildNav();let cachedShow=webui.getData(sessionKey);cachedShow&&Object.keys(cachedShow).forEach((key=>{show[key]=cachedShow[key]}))},setUserRole:function(userRole){this.userRole=userRole||0,this._buildNav()},setNavRoutes:function(data){this.buildNav(data)},loadRoutes:async function(url){if(!url)return;let loaded=await fetch(url);if(!loaded.ok)return;let data=await loaded.text();this.buildNav(data)},buildLink:function(parent,link){const t=this;let el=null;if(!(link.role&&link.role>0&&0==(link.role&t.userRole))){if(link.url)el=webui.create("webui-nav-link"),el.setAttribute("url",link.url);else{if(!link.children)return void console.error("Invalid nav item",link);el=webui.create("webui-nav-group"),void 0===show[link.name]&&(show[link.name]=!0),show[link.name]&&("function"==typeof el.setShow?el.setShow(!0):setTimeout((()=>{el.setShow(!0)}),100)),el.addEventListener("change",(_=>{show[link.name]=el.isOpen,webui.setData(sessionKey,show)})),link.children.forEach((child=>{t.buildLink(el,child)}))}link.icon&&(el.setAttribute("icon",link.icon),link.iconFamily&&el.setAttribute("family",link.iconFamily)),el.setAttribute("name",link.name),parent.appendChild(el)}},buildNav:function(navJson){if(!navJson)return;let nav="string"==typeof navJson?JSON.parse(navJson):"function"==typeof navJson.forEach?navJson:[];this._navData=nav,this._buildNav()},_buildNav:function(){const t=this;let nav=t._navData;nav&&(t.classList.add("building"),t.innerHTML="",nav.forEach((link=>{t.buildLink(t,link)})),setTimeout((()=>{t.classList.remove("building")}),100))}})}