/*!
 * Web UI Alerts - https://webui.stoicdreams.com/components#webui-alerts
 * Displays Alert icon and enables webui.alert(message:string|html, variant:string[success|warning|danger|info]) for displaying popup alerts.
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2024-2025 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
"use strict";{const alertList=[];let alertTrigger="trigger-alert";const popup=webui.create("section");popup.classList.add("webui-alerts-popup"),popup.style.display="block",popup.style.position="fixed",popup.style.bottom="30px",popup.style.right=0,popup.style.overflow="visible",document.body.appendChild(popup);let popupTiming=5e3;function getAlertHeader(){console.log("getAlertHeader",this);const container=webui.create("header");return container.style.padding="var(--padding)",container.setAttribute("slot","header"),container.innerHTML=this.alertTitle,container}function getAlertContent(){console.log("getAlertContent",this);const container=webui.create("section");if(container.style.padding="var(--padding)",0===alertList.length)container.innerHTML='<webui-alert variant="info" show>You have no alerts at this time.</webui-alert>';else{let index=0;for(;index<alertList.length;){let alert=alertList[index];alert.userclosed?alertList.splice(index,1):(alert.setAttribute("show",!0),index++,container.appendChild(alert))}}return container}function showAlertsInDialog(){const t=this;console.log("showAlertsInDialog",t),webui.dialog({title:getAlertHeader.bind(t)(),content:getAlertContent.bind(t)(),confirm:"Close"})}function showAlertsInDrawer(drawer){const t=this;console.log("showAlertsInDrawer",t);let el=document.querySelector(drawer);if(el){if(el.classList.contains("open"))return el.classList.remove("open"),void setTimeout((()=>showAlertsInDrawer.bind(t)(drawer)),500);el.innerHTML="",el.appendChild(getAlertHeader.bind(t)()),el.appendChild(getAlertContent.bind(t)()),setTimeout((()=>{el.classList.add("open")}),100)}else showAlertsInDialog.bind(t)()}webui.define("webui-alerts",{preload:"icon alert dialogs",alertTitle:"Alerts",constructor:t=>{t.count=0,console.log("constructor",t),t.icon=t.template.querySelector("webui-icon"),window.webuiAlert||(webui.alert=(message,variant)=>{const msg=message.nodeName?message.innerText:message,hc=webui.hashCode(`${variant}-${msg}`);let index=-1;alertList.forEach((al=>{index++,al.userclosed&&(alertList.splice(index,1),index--,al.remove())}));let alert=alertList.filter((i=>i._hashCode===hc))[0];if(alert)return alert.increment(),popup.appendChild(alert),alert.display(),void setTimeout((()=>{alert.parentNode===popup&&alert.removeAttribute("show")}),popupTiming);alert=webui.create("webui-alert"),alert._hashCode=hc,message.nodeName?alert.appendChild(message):alert.innerHTML=message,alert.setAttribute("variant",variant||"danger"),alert.display(),alert.style.margin="0 10px 10px 0",alert.userclosed=!1,alertList.push(alert),t.setCount(t.count+1),popup.appendChild(alert),setTimeout((()=>{alert.parentNode===popup&&alert.removeAttribute("show")}),popupTiming)},window.webuiAlert=webui.alert),t.addEventListener("click",(_ev=>(t.drawer?(console.log("verify t",t),showAlertsInDrawer.bind(t)(t.drawer)):showAlertsInDialog.bind(t)(),!0))),setTimeout((()=>t.checkCounts()),1e3)},attr:["data-toggleclass","data-title"],attrChanged:(t,property,value)=>{switch(property){case"dataTitle":t.alertTitle=value;break;case"dataPopup":let timing=parseInt(value);timing&&(popupTiming=timing);break;case"dataToggleclass":t.drawer=value.split("|")[0]}},setCount:function(value){this.count=value,this.icon.setAttribute("count",0===value?"":value.toLocaleString()),0===this.count?this.icon.setAttribute("theme","info"):this.icon.setAttribute("theme","success")},checkCounts:function(){let newCount=0;alertList.map((a=>{a.userclosed||newCount++})),newCount!=this.count&&this.setCount(newCount),setTimeout((()=>this.checkCounts()),1e3)},triggerAlert:function(data,a){const t=this;if(!data)return;if(!data.message||!data.show)return void(data.show&&(data.show=void 0,webui.setData(alertTrigger,data)));const lastTriggered=webui.hashCode(JSON.stringify(data));if(t._lastTrigger===lastTriggered)return void(data.show&&(data.show=void 0,webui.setData(alertTrigger,data)));t._lastTrigger=lastTriggered;let message=data.message,variant=data.variant||data.theme||"info";t._lastTrigger=data.message="",data.show=void 0,webui.setData(alertTrigger,data),webui.alert(message,variant),setTimeout((()=>{t._lastTrigger===lastTriggered&&(t._lastTrigger=void 0)}),100)},connected:function(t){t.dataset.subscribe&&(alertTrigger=t.dataset.subscribe),t.dataset.subscribe=`${alertTrigger}:triggerAlert`},shadowTemplate:'\n<webui-icon icon="bell|fill|shade:tri|theme:info"></webui-icon>\n<style type="text/css">\n:host {\ndisplay:inline-flex;\ncursor:pointer;\npadding:1px;\nalign-items:center;\njustify-content:center;\n}\n</style>\n'})}