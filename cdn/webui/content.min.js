/*!
 * Web UI Content - https://webui.stoicdreams.com
 * This component is used for dynamically loading and grouping page content to lazy-load content when becoming visible and detaching content when not visible.
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2024-2025 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
"use strict";webui.define("webui-content",{watchVisibility:!0,constructor:t=>{t.loadDelay=300,t._storedNodes=null,t._fixedHeight=null,t._prevInlineHeight=null},contentAttached:!1,linkCss:!0,attr:["src","load-delay","height","width"],flags:["cache","nodetach","nofix","preload"],attrChanged:(t,property,value)=>{switch(property){case"height":t.style.height=webui.pxIfNumber(value);break;case"width":t.style.width=webui.pxIfNumber(value);break;case"loadDelay":t.loadDelay=parseInt(value)||0;break;case"visible":t.visible?t._reattachChildrenIfNeeded():t._detachChildrenIfNeeded(),t.updateContent();break;case"src":t.setSrc(value)}},connected:t=>{t.innerHTML&&(t.src||(t.src="html"),t._contentLoaded="html",t.classList.remove("loading"),t.classList.add("loaded")),setTimeout((()=>t.updateContent()),10)},updateContent:function(){const t=this;t.preload?t.fetchContent():t.visible&&setTimeout((()=>t.fetchContent()),t.loadDelay)},setHtml:function(html){const t=this;t.src="html",t._contentLoaded="html",t.classList.remove("loading"),t.classList.add("loaded"),t.innerHTML=html,t.contentAttached=!0},setSrc:function(value){let t=this;t.src=value,t._contentLoaded=!1,t.fetchContent()},loadSrc:async function(){const t=this;if(t.src&&"html"!==t.src){if(t._contentLoaded&&t._contentLoaded===t.src)for(;t._isLoading;)await webui.wait(10);t._isLoading=!0,t._contentLoaded=t.src;try{let content=null;t.cache?content=await webui.fetchWithCache(t.src):(content=await fetch(t.src),content=content.ok?await content.text():null),content=content||`Failed to load content from ${t.src}`,content.startsWith("<!DOCTYPE")&&(content=`Source ${t.src} did not return expected markdown/html snippet (Full HTML documents are not allowed by t component)`),t._content=content,t._isLoading=!1}catch(ex){t._content=`Source ${t.src} failed to load:${ex}`,t._isLoading=!1}}},fetchContent:async function(){const t=this;if(t.src)if(t.visible){t.classList.add("loading");try{if(await t.loadSrc(),t.hasAttribute("slot")||t.hasAttribute("nest"))t.innerHTML=webui.applyAppDataToContent(t._content),t.contentAttached=!0;else{let temp=webui.create("div");temp.innerHTML=webui.applyAppDataToContent(t._content);let n=[],p=t.parentNode,b=t;temp.childNodes.forEach((node=>{n.push(node)})),n.forEach((node=>{p.insertBefore(node,b)})),t.parentNode!==p&&b.remove(),t.contentAttached=!0,t.remove()}}catch(ex){t.innerHTML=`Source ${t.src} failed to load:${ex}`,t.contentAttached=!0}finally{t.classList.remove("loading"),t.classList.add("loaded")}}else t.preload&&setTimeout((()=>{t.loadSrc()}),100)},_detachChildrenIfNeeded:function(){const t=this;if(t.nodetach)return;if(t._storedNodes)return;if(!(t.nofix||t.hasAttribute("height")||t.style&&t.style.height&&""!==t.style.height)){const rect=t.getBoundingClientRect();t._prevInlineHeight=t.style.height||"",t._fixedHeight=Math.round(rect.height),t._fixedHeight>0&&(t.style.height=t._fixedHeight+"px")}t.contentAttached=!1;const frag=document.createDocumentFragment();for(;t.firstChild;)frag.appendChild(t.firstChild);t._storedNodes=frag},_reattachChildrenIfNeeded:function(){const t=this;if(!t._storedNodes)return;t.appendChild(t._storedNodes),t.contentAttached=!0,t._storedNodes=null;const hadExplicitHeight=t.nofix||t.hasAttribute("height")||t._prevInlineHeight&&""!==t._prevInlineHeight;requestAnimationFrame((()=>{hadExplicitHeight||(t.style.height=t._prevInlineHeight||""),t._fixedHeight=null,t._prevInlineHeight=null}))},shadowTemplate:'\n<slot></slot>\n<style type="text/css">\n:host {\n--scroll-color: color-mix(in srgb, var(--theme-color) 20%, transparent);\n--scroll-shadow: -4px 0 -4px rgba(255, 255, 255, 0.2) inset;\n}\n:host(:not([theme])) {\n--theme-color: var(--color-background);\n--theme-color-offset: var(--color-background-offset);\n}\n:host(:not(.loaded)) slot,\n:host(:not([visible])) slot {\nvisibility:hidden;\n}\nslot {\ndisplay:block;\nmin-width:100%;\nmin-height:100%;\noverflow:auto;\n}\n::-webkit-scrollbar,\n*::-webkit-scrollbar {\nbackground-color: var(--scroll-color);\nbox-shadow: var(--scroll-shadow);\n}\n:host(:not(.loaded)) {\ndisplay:flex;\nflex-direction:column;\ngap: var(--padding);\nalign-items: center;\njustify-content: center;\n}\n:host(:not(.loaded)):before {\ncontent: " ";\ndisplay:block;\nposition: absolute;\nanimation: spin 1s infinite linear;\nborder: 2px solid rgba(30, 30, 30, 0.5);\nborder-left: 4px solid #fff;\nborder-radius: 50%;\nheight: 50px;\nmargin-bottom: 10px;\nwidth: 50px;\ntop:50px;\n}\n:host(:not(.loaded).loading):after {\ncontent: \'Loading\';\nanimation: load 2s linear infinite;\n}\n:host([visible].loaded) {\nanimation: animation-fadein 300ms ease-in;\n}\n</style>\n'});