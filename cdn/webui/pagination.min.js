/*!
 * Web UI Pagination - https://webui.stoicdreams.com/components#webui-pagination
 * A component for displaying and managing pagination controls within the web UI.
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2024-2025 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
"use strict";webui.define("webui-pagination",{preload:"button",_pageCount:0,_totalCount:0,constructor:t=>{t._input=t.template.querySelector("input"),t._slot=t.template.querySelector("slot"),t._prev=t.template.querySelector("div.prev"),t._pages=t.template.querySelector("div.pages"),t._next=t.template.querySelector("div.next"),t._btnFirst=t.template.querySelector("webui-button.first"),t._btnPrev=t.template.querySelector("webui-button.prev"),t._btnNext=t.template.querySelector("webui-button.next"),t._btnLast=t.template.querySelector("webui-button.last"),t._total=t.template.querySelector(".total > strong"),t._data=void 0,t.perPage=1,t._index=0,t.page=1,t._input.value=1,t._btnFirst.addEventListener("click",(_=>{1!==t.page&&t.setValue(1)})),t._btnPrev.addEventListener("click",(_=>{t.page>1?t.setValue(t.page-1):void 0!==t.loop&&t.setValue(t.pageCount)})),t._btnNext.addEventListener("click",(_=>{t.page<t.pageCount?t.setValue(t.page+1):void 0!==t.loop&&t.setValue(1)})),t._btnLast.addEventListener("click",(_=>{t.page!==t.pageCount&&t.setValue(t.pageCount)})),t._input.addEventListener("input",(_=>{let page=parseInt(t._input.value)||t.page;page!==t.page&&(t.setValue(page),t._input.value!==t.page&&(t._input.value=t.page))}))},props:{totalCount:{get(){return this._totalCount},set(v){this._totalCount!==v&&(this._totalCount=v,this._total.innerText=v.toLocaleString("en-US"),this.process())}},pageCount:{get(){return this._pageCount},set(v){this._pageCount!==v&&(this._pageCount=v,this.setAttribute("page-count",v),this.process())}}},attr:["data-current","data-subscribe","value","page","per-page","hide-prev-next-buttons","hide-pages","loop","max-pages"],attrChanged:(t,property,value)=>{switch(property){case"perPage":let num=parseInt(value);`${num}`===value&&(t.perPage=num);break;case"page":case"value":t.setValue(value||1);break;case"maxPages":t.maxPages=parseInt(value)||0}},connected:t=>{let data="";if(t._slot.assignedElements().length){let ch=[];t._slot.assignedElements().forEach((node=>{ch.push(node.innerText)})),data=ch.join("\n"),t.setData(data)}let ds=t.dataset.subscribe;ds&&ds.split("|").forEach((ds=>{let kt=ds.split(":");if(2===kt.length&&"setData"===kt[1]){let attempts=0;function tryGetData(){t._data&&t._data.length||(data=webui.getData(kt[0]),data?t.setData(data):++attempts<5&&setTimeout((()=>tryGetData()),100*attempts))}tryGetData()}}))},process:function(){const t=this;if(t._data&&t._data.forEach){let current=t._currentData||{};if(0===t._data.length)return t.pageCount=0,t.totalCount=0,void(t.dataCurrent&&webui.setData(t.dataCurrent,current));if(t.page=t.page,t.pageCount=Math.ceil(t._data.length/t.perPage),t.totalCount=t._data.length,t.page>t.pageCount&&(t.page=t.pageCount,t._index=t.page-1,t.value=t.page),1===t.perPage)current=t._data[t._index];else{current=[];for(let index=t._index;index<t._data.length;++index)current.push(t._data[index])}t._currentData=current,webui.setData(t.dataCurrent,current)}t.dataset.subscribe&&t.dataset.subscribe.split("|").forEach((ds=>{let dk=ds.split(":");1!==dk.length&&"setValue"===dk[1]&&webui.setData(dk[0],t.page)})),t.render()},render:function(){const t=this;if(!t.hasChanges)return;1===t.page?t._btnFirst.setAttribute("disabled","true"):t._btnFirst.removeAttribute("disabled"),t.page===t.pageCount?t._btnLast.setAttribute("disabled","true"):t._btnLast.removeAttribute("disabled"),t._input.value=t.page||1;let cw=`${t.page}`.length+5;if(t._input.style.width=`${cw}ch`,t._pages.querySelectorAll("webui-button").forEach((b=>b.remove())),!t.hidePages&&0!==t.maxPages){let mp=void 0===t.maxPages?10:Math.abs(t.maxPages),pl=Math.floor(mp/2),ps=t.page-pl;ps<1&&(ps=1);let pr=ps+mp-1;pr>t.pageCount&&(pr=t.pageCount,ps>1&&(ps=Math.max(1,pr-(mp-1))));for(let pn=ps;pn<=pr;++pn)if(pn===t.page);else{let pageNumber=pn,page=webui.create("webui-button",{html:`${pageNumber}`});page.addEventListener("click",(_=>{t.setValue(pageNumber)})),pageNumber<t.page?t._pages.insertBefore(page,t._input):t._pages.appendChild(page)}}t._hasRendered=!0},setValue:function(value,key,toSet){const t=this;void 0!==(value=value||1)&&void 0!==value&&("string"==typeof value&&(value=parseInt(value)||1),"number"==typeof value&&(value<1&&(value=1),value===t.page&&t._hasRendered||(t.page=value,t._index=t.page-1,t.value=t.page,t.process())))},setData:function(value){const t=this;if("string"==typeof value)try{value?value=JSON.parse(value):(t._data=[],t.totalCount=0)}catch(ex){return}null!=value?(value.forEach||(value=[value]),JSON.stringify(t._data)!==JSON.stringify(value)&&t._data!==value&&(t._data=value,t.process())):void 0!==t._data&&(t._data=void 0,t.process())},shadowTemplate:'\n<div class="spacer-left"></div>\n<div class="prev">\n<webui-button class="first" start-icon="caret-line|has-shadow:true|rotate:270|fill"></webui-button>\n<webui-button class="prev" start-icon="caret|has-shadow:true|rotate:270|fill"></webui-button>\n</div>\n<div class="pages">\n<input type="number" value="1" min="1" />\n</div>\n<div class="next">\n<webui-button class="next" start-icon="caret|has-shadow:true|rotate:90|fill"></webui-button>\n<webui-button class="last" start-icon="caret-line|has-shadow:true|fill|rotate:90"></webui-button>\n</div>\n<div class="spacer-right"></div>\n<div class="total"><span>Total: </span><strong>0</strong></div>\n<pre><slot></slot></pre>\n<style type="text/css">\n:host {\ndisplay:grid;\ngrid-template-columns:auto max-content max-content max-content 0;\ngap:var(--padding);\n}\n:host([page-count="2"]) .first,\n:host([page-count="2"]) .last,\n:host([page-count="3"]) .first,\n:host([page-count="3"]) .last,\n:host([page-count="4"]) .first,\n:host([page-count="4"]) .last,\n:host([page-count="1"]) .prev,\n:host([page-count="1"]) .next,\n:host([page-count="0"]),\n:host(:not([page-count])) {\ndisplay:none;\n}\ndiv.prev,\ndiv.pages,\ndiv.next {\ndisplay:flex;\ngap:var(--padding);\n}\ndiv.total {\ndisplay:flex;\ngrid-column:1/5;\nalign-items: center;\njustify-content: right;\n}\ndiv.total > span {\npadding: 0 0.5ch 0 0;\n}\ninput[type="number"] {\nbackground-color:color-mix(in srgb, var(--theme-color) 80%, white);\ncolor:var(--theme-color-offset);\nborder:none;\nbox-sizing:border-box;\npadding:var(--padding);\ntext-align:center;\nborder-radius:var(--corners);\n}\n:host([page-count="1"]) input[type="number"] {\ncursor:default;\npointer-events:none;\n}\n:host([page-count="1"]) .pages {\ndisplay:none;\n}\npre {display:none;}\n</style>'});