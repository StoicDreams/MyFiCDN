"use strict";{function extractOptions(options){if(null==options||""===options)return[];if(!options)return[];if("string"==typeof options)try{let items=JSON.parse(options);return items&&"function"==typeof items.forEach?items:(console.error("Invalid dropdown options",items,options),[])}catch(ex){return options.split(",").map((item=>({id:item=item.trim(),value:item,display:item})))}return"function"!=typeof options.forEach?(console.error("Invalid dropdown options",options,typeof options),[]):options}webui.define("webui-dropdown",{preload:"icon",apiMethod:"GET",_value:void 0,constructor:t=>{t._template=t.template.querySelector('slot[name="template"]');let optionTemplate=t.querySelector('[slot="template"]');optionTemplate&&(t._optionTemplate=webui.trimLinePreWhitespce(optionTemplate.innerHTML)),t.newid="",t.newlabel="New",t._forLabel=t.template.querySelector("label"),t._label=t.template.querySelector('slot[name="label"]'),t._select=t.template.querySelector("select"),t._startIcon=t.template.querySelector("webui-icon.start"),t._midIcon=t.template.querySelector("webui-icon.mid"),t._endIcon=t.template.querySelector("webui-icon.end"),t._select.addEventListener("change",(_=>{t.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),t._optionsSet&&t.applyDataChange()}))},flags:["multiple"],attr:["icon","start-icon","mid-icon","end-icon","label","stack","value","newid","newlabel","options","api"],attrChanged:(t,property,value)=>{switch(property){case"api":let segments=value.split("|"),api=value;segments.length>1&&-1!==["get","post","put","delete","patch"].indexOf(segments[0].toLowerCase())&&(t.apiMethod=segments[0].toUpperCase(),api=segments[1]),api&&(t.apiUrl=api),t.loadData();break;case"options":t.setOptions(value);break;case"newid":case"newlabel":t._includeNew=!0;break;case"label":t._label.innerHTML=value,value?t._forLabel.classList.remove("hide"):t._forLabel.classList.add("hide");break;case"startIcon":case"icon":t._startIcon.setAttribute("icon",value);break;case"midIcon":t._midIcon.setAttribute("icon",value);break;case"endIcon":t._endIcon.setAttribute("icon",value);break;case"value":t.setValue(value)}},getApiData:function(){let key=this.dataset.api;if(!key||"string"!=typeof key)return[!0,{}];let data=webui.getData(key);if(void 0===data)return[!1,{}];if("object"!=typeof data){key=key.split(".").pop();let d={};return d[key]=data,[!0,d]}return[!0,data]},loadData:function(){const t=this;if(!t.apiUrl)return;let method=t.apiMethod,url=t.apiUrl,ct=t.contentType||"application/json",fetchData=null;const[hasRequiredData,data]=t.getApiData();if(hasRequiredData){if(data)if("get"===method.toLowerCase()){let q=[];Object.keys(data).forEach((key=>{let value=`${data[key]}`;q.push(`${key}=${encodeURIComponent(value)}`)})),url=`${url}?${q.join("&")}`}else if("multipart/form-data"===ct){const formData=new FormData;for(const key in data)data.hasOwnProperty(key)&&formData.append(key,data[key]);fetchData=formData}else fetchData=data,fetchData.headers={"Content-Type":ct};webui.fetchApi(url,fetchData,method).then((async resp=>{let message=await resp.text();if(resp.status<300){let json=await JSON.parse(message);t.setOptions(json)}else t.headerMessage&&(message=webui.getResponseHeader(resp,...t.headerMessage.split("|"))||message),message&&webui.log.error(message)})).catch((ex=>{webui.log.error("Fetch API Error:",ex)}))}else t.setOptions([])},connected:t=>{let id=webui.uuid();t._forLabel.setAttribute("for",id),t._select.setAttribute("id",id)},applyDataChange:function(){const t=this;let dn=t.dataset.name;if(dn&&t._optionsSet)if(t.multiple){let s=[];t._select.querySelectorAll("option:checked").forEach((option=>{let ds=option.dataset.data||"{}";s.push(JSON.parse(ds))})),webui.setData(dn,s)}else{let s=t._select.querySelector("option:checked");s?webui.setData(dn,JSON.parse(s.dataset.data||"{}")):webui.setData(dn,"{}")}},options:function(options){this.setOptions(options)},setOptions:function(options){const t=this;options=extractOptions(options);let oJson=JSON.stringify(options);if(oJson===t._oJson)return;t._oJson=oJson;let data=options.forEach?options:JSON.parse(options);if(!data.forEach)return void console.error("webui-dropdown data error: Invalid data loaded - Expecting an array of data.");let template=t._optionTemplate,value=t.value;if(t._select.innerHTML="",t._includeNew){let option=webui.create("option",{value:t.newid,html:t.newlabel});option.dataset.data="{}",t._select.appendChild(option)}data.forEach((item=>{let id=webui.getDefined(item[t.dataset.id],item.id,item.value);if(void 0===id&&void 0!==item.value&&(id=item.value),void 0===id)return void console.error("webui-dropdown data error: Option is missing value",item);let display=(t.dataset.display?item[t.dataset.display]:item.display)||item.display||id,option=webui.create("option",{value:id});option.dataset.data=JSON.stringify(item),option.innerHTML=template?webui.replaceAppData(template,item):display,t._select.appendChild(option)}));let dn=t.dataset.name;if(dn){let check=webui.getData(dn);void 0!==check&&(value=webui.getDefined(check[t.dataset.id],check.id,check.value))}t._optionsSet=!0,t.setValue(value)},props:{value:{get(){return webui.getDefined(this._select.value,"")},set(v){this.setValue(v)}},display:{get(){return[...this._select.selectedOptions].map((i=>i.innerText)).join(",")}}},setValue:function(value){const t=this;if(!t._isConnected||!t._optionsSet)return;value=`${value}`;let o=t._select.querySelector(`option[value="${value.replace(/\\/g,"\\\\")}"]`);if(!o){if(t.multiple)return;if(o=t._select.querySelector("option"),!o)return;value=o.value}t.value===value&&t._value===value||(t._value=value,t._select.value=value,o.selected=!0,t.applyDataChange(),t.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})))},shadowTemplate:'\n<label class="hide">\n<webui-icon class="start"></webui-icon>\n<slot name="label"></slot>\n<webui-icon class="mid"></webui-icon>\n</label>\n<div>\n<select><slot></slot></select>\n<webui-icon class="end"></webui-icon>\n</div>\n<slot name="template"></slot>\n<style type="text/css">\n:host {\ndisplay:flex;\ngap:var(--padding,1rem);\nposition:relative;\nbox-sizing:border-box;\nalign-items: center;\nwidth:100%;\nwidth:-webui-fill-available;\n--theme-color:white;\n--theme-color-offset:black;\nbackground-color: color-mix(in srgb, var(--theme-color) 90%, black);\ncolor:var(--theme-color-offset);\n}\n:host([stack]) {\ndisplay:grid;\n}\ndiv {\ndisplay:flex;\nflex-grow:1;\n}\nselect {\ndisplay:block;\nflex-grow:1;\npadding: var(--padding, 2px 5px);\nheight:100%;\nbackground-color:var(--theme-color);\ncolor:var(--theme-color-offset);\nborder-radius:var(--corners);\n}\nlabel.hide {display:none;}\nlabel {\ndisplay:flex;\nalign-items:center;\ngap:var(--padding);\npadding:var(--padding,1rem);\n}\nwebui-icon:not([icon]),\nslot[name="template"] {display:none;}\n@container container (max-width:600px) {\n:host {\ndisplay:grid;\ngap:0.1em;\n}\n}\n</style>\n'})}