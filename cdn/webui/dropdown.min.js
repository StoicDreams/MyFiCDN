"use strict";webui.define("webui-dropdown",{preload:"icon",constructor:t=>{t._template=t.template.querySelector('slot[name="template"]');let optionTemplate=t.querySelector('[slot="template"]');optionTemplate&&(t._optionTemplate=webui.trimLinePreWhitespce(optionTemplate.innerHTML)),t.newid="",t.newlabel="New",t._forLabel=t.template.querySelector("label"),t._label=t.template.querySelector('slot[name="label"]'),t._select=t.template.querySelector("select"),t._startIcon=t.template.querySelector("webui-icon.start"),t._midIcon=t.template.querySelector("webui-icon.mid"),t._endIcon=t.template.querySelector("webui-icon.end"),t._datasub=webui.create("webui-data"),t._select.addEventListener("change",(_=>{t.dispatchEvent(new Event("change",{bubbles:!0})),t._optionsSet&&t.applyDataChange()}))},attr:["icon","start-icon","mid-icon","end-icon","label","stack","value","newid","newlabel","options","data-options"],attrChanged:(t,property,value)=>{switch(property){case"dataOptions":t._datasub.setValue=val=>{t.setOptions(val)},t._datasub.setAttribute("data-subscribe",value);break;case"options":t.setOptions(value);break;case"newid":case"newlabel":t._includeNew=!0;break;case"label":t._label.innerHTML=value,value?t._forLabel.classList.remove("hide"):t._forLabel.classList.add("hide");break;case"startIcon":case"icon":t._startIcon.setAttribute("icon",value);break;case"midIcon":t._midIcon.setAttribute("icon",value);break;case"endIcon":t._endIcon.setAttribute("icon",value);break;case"value":t.setValue(value)}},connected:t=>{let id=webui.uuid();t.appendChild(t._datasub),t._forLabel.setAttribute("for",id),t._select.setAttribute("id",id)},applyDataChange:function(){let t=this,dn=t.dataset.name;if(dn&&t._optionsSet)if(t.hasAttribute("multiple")){let s=[];t._select.querySelectorAll("option:checked").forEach((option=>{let ds=option.dataset.data||"{}";s.push(JSON.parse(ds))})),webui.setData(dn,s)}else{let s=t._select.querySelector("option:checked");s?webui.setData(dn,JSON.parse(s.dataset.data||"{}")):webui.setData(dn,"{}")}},options:function(options){this.setOptions(options)},setOptions:function(options){let t=this;null!=options&&""!==options||(options=[]);let data=options.forEach?options:JSON.parse(options);if(!data.forEach)return void console.error("webui-dropdown data error: Invalid data loaded - Expecting an array of data.");let template=t._optionTemplate,value=t.value;if(t._select.innerHTML="",t._includeNew){let option=webui.create("option",{value:t.newid,html:t.newlabel});option.dataset.data="{}",t._select.appendChild(option)}data.forEach((item=>{let id=t.dataset.id?item[t.dataset.id]:item.id;if(void 0===id&&void 0!==item.value&&(id=item.value),void 0===id)return void console.error("webui-dropdown data error: Option is missing value",item);let display=(t.dataset.display?item[t.dataset.display]:item.display)||item.display||id,option=webui.create("option",{value:id});option.dataset.data=JSON.stringify(item),option.innerHTML=template?webui.replaceAppData(template,item):display,t._select.appendChild(option)}));let dn=t.dataset.name;if(dn){let check=webui.getData(dn);void 0!==check&&(value=t.dataset.id?check[t.dataset.id]:check.id)}if(void 0!==value){let o=t._select.querySelector(`option[value="${value.replace(/\\/g,"\\\\")}"]`);if(o)o.selected=!0;else{let first=t._select.querySelector("option");first&&(first.selected=!0)}}else{let first=t._select.querySelector("option");first&&(first.selected=!0)}t._optionsSet=!0,t.applyDataChange()},props:{value:{get(){return webui.getDefined(this._select.value,"")},set(v){this.setValue(v)}}},setValue:function(value){let t=this;if(!t._isConnected||!t._optionsSet)return;value=`${value}`;let o=t._select.querySelector(`option[value="${value.replace(/\\/g,"\\\\")}"]`);o&&(t._select.value=value,o.selected=!0,t.applyDataChange(),t.dispatchEvent(new Event("change",{bubbles:!0})))},shadowTemplate:'\n<label class="hide">\n<webui-icon class="start"></webui-icon>\n<slot name="label"></slot>\n<webui-icon class="mid"></webui-icon>\n</label>\n<div>\n<select><slot></slot></select>\n<webui-icon class="end"></webui-icon>\n</div>\n<slot name="template"></slot>\n<style type="text/css">\n:host {\ndisplay:flex;\ngap:var(--padding,1rem);\nposition:relative;\nbox-sizing:border-box;\nalign-items: center;\nwidth:100%;\nwidth:-webui-fill-available;\nbackground-color:var(--theme-color);\ncolor:var(--theme-color-offset);\n}\n:host([stack]) {\ndisplay:grid;\n}\ndiv {\ndisplay:flex;\nflex-grow:1;\n}\nselect {\ndisplay:block;\nflex-grow:1;\npadding: var(--padding, 2px 5px);\nheight:100%;\n}\nlabel.hide {display:none;}\nlabel {\ndisplay:flex;\nalign-items:center;\ngap:var(--padding);\npadding:var(--padding,1rem);\n}\nwebui-icon:not([icon]),\nslot[name="template"] {display:none;}\n@container (max-width:400px) {\n:host {\ndisplay:grid;\ngap:0.1em;\n}\n}\n</style>\n'});