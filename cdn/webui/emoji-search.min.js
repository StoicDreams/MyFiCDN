/*!
 * Web UI Emoji Search - https://webui.stoicdreams.com/components#webui-emoji-search
 * A component for searching and displaying emojis within the web UI.
 * Authored by Erik Gassler - Stoic Dreams
 * Copyright Â© 2024-2025 Stoic Dreams - https://www.stoicdreams.com
 * Licensed under the MIT license - https://github.com/StoicDreams/MyFiCDN/blob/main/LICENSE
 */
"use strict";{const emojiSource="My Fidelity CDN"===webui.getData("appName")?"/i/emojis.json":"https://cdn.myfi.ws/i/emojis.json";webui.define("webui-emoji-search",{linkCss:!1,preload:"pagination input-range flex grid input-text",_page:1,_perPage:20,_filteredKeys:[],constructor:t=>{t._search=t.template.querySelector('[label="Search"]'),t._size=t.template.querySelector('[label="Size"]'),t._grid=t.template.querySelector(".grid"),t._pag=t.template.querySelector("webui-pagination"),console.log("emojis constructed")},applyPagination:t=>{t=t||this;let id=webui.uuid();t._apid=id,setTimeout((async()=>{if(t._apid===id&&t._pag){for(;!t._pag._isConstructed;)console.log("apply pagination wait for construction",t,t._pag._isConstructed),await webui.wait(10);console.log("apply pagination start:page:%o;perPage:%o;count:%o;total:%o",t.page,t.perPage,t.pageCount,t.totalCount),t._pag.page=t.page,t._pag.perPage=t.perPage,t._pag.pageCount=t.pageCount,t._pag.totalCount=t.totalCount,t.page>t.pageCount&&(t.page=t.pageCount),console.log("applied pagination:page:%o;perPage:%o;count:%o;total:%o",t._pag.page,t._pag.perPage,t._pag.pageCount,t._pag.totalCount),t.render()}}),10)},props:{page:{get(){return this._page},set(v){this._page=v,this.applyPagination(this)}},perPage:{get(){return this._perPage},set(v){this._perPage=v,this.applyPagination(this)}},pageCount:{get(){return Math.floor(this._filteredKeys.length/this.perPage)}},totalCount:{get(){return this._totalCount},set(v){this._totalCount=v,this.applyPagination(this)}}},attr:["height","max-height"],attrChanged:(t,property,value)=>{switch(property){case"height":t.style.height=webui.pxIfNumber(value);break;case"maxHeight":t.style.maxHeight=webui.pxIfNumber(value)}},applyStyles:function(){this.style.setProperty("--font-size",`${this._size.value}em`)},connected:function(t){let timer;console.log("emojis connected"),t._size.addEventListener("change",(_=>{t.applyStyles()})),t._search.addEventListener("input",(_=>{clearTimeout(timer),timer=setTimeout((()=>{t._filter=t._search.value.trim(),t.applyFilter(),t.render()}),300)}));let size=webui.getData("session-emoji-search-size");size||(size=2,webui.setData("session-emoji-search-size",size)),t._size.value=size,t.setAttribute("data-subscribe","session-emoji-search-index:page"),webui.getData("session-emoji-search-index:page")||webui.setData("session-emoji-search-index",1),webui.fetchWithCache(emojiSource,!0).then((emojis=>{t.emojis=emojis,t.applyFilter(),t.render()}))},applyFilter:function(){const t=this;if("string"!=typeof t._search.value)return;let filter=t._search.value.trim();t._filteredKeys=[],Object.keys(t.emojis).forEach((key=>{filter&&-1===key.indexOf(filter.toLowerCase())||t._filteredKeys.push(key)})),t.totalCount=t._filteredKeys.length},render:function(){const t=this;if(!t.emojis)return;console.log("emojis render start"),t._grid.innerText="";let perPage=t.perPage||20,startIndex=((t.page||1)-1)*perPage;startIndex>t._filteredKeys.length&&(startIndex=0);let endIndex=startIndex+perPage;t._filteredKeys.slice(startIndex,endIndex).forEach((key=>{const code=`:${key}:`;let el=webui.create("a",{title:code,html:t.emojis[key]});t._grid.appendChild(el),el.addEventListener("click",(ev=>{ev.stopPropagation(),ev.preventDefault(),webui.copyToClipboard(code)}))})),t.applyStyles(),console.log("emojis render finish")},shadowTemplate:'\n<webui-flex gap="10">\n<webui-input-text label="Search"></webui-input-text>\n<webui-input-range label="Size" min="1" max="5" step="0.5" data-subscribe="session-emoji-search-size:setValue" data-trigger="session-emoji-search-size"></webui-input-range>\n</webui-flex>\n<webui-pagination class="my-a" data-subscribe="session-emoji-search-index:setValue" loop max-pages="3"></webui-pagination>\n<webui-flex wrap gap="20" justify="center" class="pa-1 grid" theme="inherit"></webui-flex>\n<style type="text/css">\n:host {\ndisplay:block;\noverflow:auto;\noverflow-x:hidden;\n}\na {\ndisplay:block;\nfont-size:var(--font-size);\naspect-ratio:1;\nwidth:var(--font-size);\ncursor:pointer;\n}\nwebui-flex {\nwidth:100%;\n}\n</style>\n<slot></slot>\n<slot name="something"></slot>\n'})}